<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>实习日志 | 李阳的秘密小屋</title><meta name="keywords" content="实习"><meta name="author" content="李阳"><meta name="copyright" content="李阳"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="实习日志"><meta name="application-name" content="实习日志"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="实习日志"><meta property="og:url" content="https://blog.baskly.fun/posts/65070/index.html"><meta property="og:site_name" content="李阳的秘密小屋"><meta property="og:description" content="实习日志"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2024/11/24/674340e1191e4.png?_r_=4df18ead-b896-9763-5b8b-8b2b8754a0cf"><meta property="article:author" content="李阳"><meta property="article:tag" content="bask,李阳"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2024/11/24/674340e1191e4.png?_r_=4df18ead-b896-9763-5b8b-8b2b8754a0cf"><meta name="description" content="实习日志"><link rel="shortcut icon" href="/img/flow-32x32.ico"><link rel="canonical" href="https://blog.baskly.fun/posts/65070/"><link rel="preconnect" href="//cdn.cbd.int"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="var(--anzhiyu-main)"><link rel="mask-icon" href="/img/siteicon/yang180.png" color="#5bbad5"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/yang180.png"><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/yang180.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/yang32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/yang16.png"><link rel="bookmark" href="/img/siteicon/yang180.png"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={linkPageTop:void 0,peoplecanvas:void 0,postHeadAiDescription:{enable:!0,gptName:"Liyang",mode:"local",switchBtn:!1,btnLink:"https://afdian.net/item/886a79d4db6711eda42a52540025c377",randomNum:3,basicWordCount:1e3,key:"xxxx",Referer:"https://xx.xx/"},diytitle:{enable:!0,leaveTitle:"不要走",backTitle:"不要离开我     -"},LA51:void 0,greetingBox:{enable:!0,default:"晚上好👋",list:[{greeting:"晚安😴",startTime:0,endTime:5},{greeting:"早上好鸭👋, 祝你一天好心情！",startTime:6,endTime:9},{greeting:"上午好👋, 状态很好，鼓励一下～",startTime:10,endTime:10},{greeting:"11点多啦, 在坚持一下就吃饭啦～",startTime:11,endTime:11},{greeting:"午安👋, 要睡觉喽",startTime:12,endTime:14},{greeting:"🌈充实的一天辛苦啦！",startTime:14,endTime:18},{greeting:"19点喽, 奖励一顿丰盛的大餐吧🍔。",startTime:19,endTime:19},{greeting:"晚上好👋, 在属于自己的时间好好放松😌~",startTime:20,endTime:24}]},twikooEnvId:"https://twikoo.baskly.fun",commentBarrageConfig:void 0,music_page_default:"nav_music",root:"/",preloader:{source:3},friends_vue_info:void 0,navMusic:!0,mainTone:{mode:"both",api:null,cover_change:!0},authorStatus:{skills:["东隅已逝 桑榆非晚","集中精神 攻克难关"]},algolia:void 0,localSearch:{path:"/search.xml",preload:!0,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简",rightMenuMsgToTraditionalChinese:"转为繁体",rightMenuMsgToSimplifiedChinese:"转为简体"},noticeOutdate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:330},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,simplehomepage:!0,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{copy:!0,copyrightEbable:!1,limitCount:50,languages:{author:"作者: 李阳",link:"链接: ",source:"来源: 李阳的秘密小屋",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。",copySuccess:"复制成功，复制和转载请标注本文地址"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#425AEF",bgDark:"#1f1f1f",position:"top-center"},source:{justifiedGallery:{js:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js",css:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,shortcutKey:void 0,autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"李阳的秘密小屋",title:"实习日志",postAI:"",pageFillDescription:"10月9日 第一天, 工作收获, 空间函数的数据类型有哪些, 1. 基本几何类型（Geometry）, 2. 地理类型（Geography）, 3. 三维与测量类型, 4. 其他辅助类型, 5. 总结, 6. 使用举例, 1. 基本几何类型（geometry）, 2. 地理类型（geography）, 3. 三维与测量类型（Z/M 坐标）, 4. 边界框类型（BOX2D/BOX3D）, 空间数据格式有哪些, 1. 存储格式（数据库内部存储）, 2. 序列化格式（输入 / 输出 / 交换格式）, 3. 总结, 4. 举例子, 1. WKT（Well-Known Text）格式, 2. EWKT（Extended WKT）格式, 3. WKB/EWKB（二进制格式）, 4. GeoJSON 格式, 5. KML格式, 6. Shapefile 格式（导入 / 导出）, 不同格式之间的转换, 1. 文本格式 ↔ 内部 geometry 类型, 1. WKT ↔ geometry, 2. EWKT ↔ geometry, 2. 二进制格式 ↔ 内部 geometry 类型, 1. WKB ↔ geometry, 2. EWKB ↔ geometry, 3. Web 常用格式 ↔ geometry 类型, 1. GeoJSON ↔ geometry, 2.  KML ↔ geometry, 4. 跨格式间接转换（以 geometry 为中间层）, 1. 示例 1：WKT → GeoJSON, 2. 示例 2：KML → EWKT, 5. 坐标系转换（SRID 变更）, 6. 总结, 空间数据的增删查改, 1. 准备工作：创建带空间字段的表, 2. 增加（Create）空间数据, 1. 示例：插入城市点数据, 3. 查询（Read）空间数据, 1. 示例 1：查询所有城市的基本信息和空间坐标（WKT 格式）, 2. 示例 2：查询距离北京 1000 公里以内的城市（用 geography 类型计算球面距离）, 3. 示例 3：查询某矩形范围内的城市（如经度 110°~120°纬度 20°~35°）, 4. 更新（Update）空间数据, 1. 示例 1：修改城市的坐标（如调整深圳的经纬度）, 2. 示例 2：批量更新坐标系（如从 SRID=4326 转为 UTM 50N 的 SRID=32650）, 5. 删除（Delete）空间数据, 1. 示例 1：删除指定城市, 2. 示例 2：删除人口少于 1000 万的城市, 6. 总结, 常用基础空间查询函数的使用, 一. 几何关系查询函数, 1. ST_Contains(geomA geomB), 2. ST_Intersects(geomA geomB), 3. ST_DWithin(geomA geomB distance), 4. ST_Touches(geomA geomB), 二、 测量计算函数, 1. ST_Distance(geomA geomB), 2. ST_Length(geom), 3. ST_Area(geom), 4. ST_Perimeter(geom), 三、几何转换与提取函数, 1. ST_AsText(geom)/ST_AsGeoJSON(geom), 2. ST_Centroid(geom), 3. ST_Transform(geom target_srid), 4. ST_Buffer(geom distance), 四、几何属性查询函数, 1. ST_GeometryType(geom), 2. ST_SRID(geom), 3. ST_NPoints(geom), 五、总结, 常用分析函数的使用, 一、缓冲区分析（Buffer Analysis）, 1. 函数：ST_Buffer(geom distance), 二、叠加分析, 1. ST_Intersection(geomA geomB), 2. ST_Union(geomA geomB), 3. ST_Difference(geomA geomB), 三、最近邻分析（Nearest Neighbor）, 1. 函数组合：ST_Distance + 排序, 四、密度分析（Density Analysis）, 1. 生成网格并统计密度, 2. 核密度估计（需 PostGIS 3.0+）, 五、网络分析（Network Analysis）, 1. 线串拆分与节点提取, 2. 最短路径, 六、空间聚合分析, 七、总结, 10月10日 第二天月日第一天工作内容今天主要了解空间数据类型有哪些空间数据格式有哪些不同格式之间的转换空间数据的增删查改常用基础空间查询函数的使用常用分析函数的使用工作收获空间函数的数据类型有哪些作为的空间扩展定义了一系列用于处理空间数据的特殊数据类型这些类型是空间函数操作的基础以下是中主要的空间数据类型分类及说明基本几何类型是中最核心的空间数据类型用于表示二维平面上的几何对象遵循简单要素规范支持以下子类型点零维对象表示单个坐标点如线串一维对象由多个点连接成的线段如多边形二维对象由闭合线串及内部区域组成如多点多个点的集合如多线串多个线串的集合如多多个多边形的集合如几何集合多种几何类型的混合集合如每个对象都包含空间参考系用于定义坐标的投影和单位如对应地理类型类型用于表示椭球面上的地理数据如地球表面的经纬度坐标与的主要区别基于球面计算距离面积等而非平面结果更符合实际地理场景如地球曲率影响支持的子类型与一致点线串多边形等但隐含为经纬度坐标也可指定其他椭球坐标系计算成本高于适合大范围跨半球数据小范围数据常用三维与测量类型支持带坐标三维和坐标测量值如时间距离的扩展类型几何在基本类型后加如三维点三维线串表示包含高程信息的对象测量几何加如带测量值的点三维测量值的线串其他辅助类型二维边界框表示的最小外接矩形如三维边界框包含坐标的最小外接立方体部分函数返回的几何非标准类型较少直接使用栅格数据类型需启用扩展用于处理影像遥感数据等总结的空间函数主要操作和两大核心类型其中适用于平面投影数据适用于球面地理数据两者均支持点线面等基本几何形态及三维测量扩展选择类型时需根据数据的空间尺度投影方式及计算需求决定使用举例平面坐标适合小范围计算快如城市内建筑道路球面坐标适合大范围结果更精确如跨国距离全球城市类型扩展维度用于高程时间等附加信息如山峰海拔路线距离边界框辅助快速范围查询优化性能基本几何类型适用于平面坐标如投影地方坐标系计算效率高适合小范围如城市园区数据示例创建点并查询距离假设某城市使用投影单位米存储两个建筑的坐标创建测试表带约束明确类型为插入数据坐标单位为米图书馆生成点指定坐标系体育馆计算两点距离平面距离单位米结果约为米勾股定理示例创建多边形并判断包含关系存储一个园区的边界判断某点是否在园区内创建园区表插入园区边界闭合多边形坐标按顺时针逆时针顺序中央公园判断图书馆是否在公园内使用结果图书馆在公园内地理类型适用于球面坐标经纬度计算结果考虑地球曲率适合大范围如跨国全球数据示例计算两地球面距离经纬度存储两个城市的经纬度计算实际地表距离创建城市表类型默认单位度无需显式指定默认经纬度插入数据经度纬度北京经纬度转上海计算球面距离单位米自动考虑地球曲率结果约为公里接近实际公路距离三维与测量类型坐标用于包含高程或附加测量值如时间温度的场景示例三维点存储海拔记录山峰的经纬度和海拔三维点经纬度海拔插入数据经度纬度海拔米珠穆朗玛峰查询海拔提取坐标结果米示例带测量值的线串记录一条路线的经纬度和累计距离值线串测量值距离插入路线点依次为起点中途点终点值为累计距离公里香山步道提取中途点的距离值取第个点取值结果公里边界框类型用于快速范围查询避免复杂几何计算示例用筛选范围内的点查询某矩形区域内的建筑定义查询范围左下角右上角坐标结果返回图书馆坐标在范围内生成边界框判断几何是否与边界框相交效率高于直接用多边形判断空间数据格式有哪些在中空间数据的格式通常指数据的存储格式和序列化格式用于数据输入输出或交换以下是主要的空间数据格式分类及说明存储格式数据库内部存储在中存储空间数据时采用高效的二进制格式主要包括是内部存储空间数据的原生格式基于标准的扩展而来相比增加了空间参考标识符的存储能直接关联坐标系信息而本身不包含二进制格式紧凑读写效率高适合数据库内部存储和快速计算示例表中或类型的字段值本质上就是编码的二进制数据类型的存储类型本质上也是以格式存储但隐含默认经纬度且存储的坐标是经纬度度而非平面坐标米序列化格式输入输出交换格式在与外部系统交互如导入导出查询返回时支持多种文本或二进制格式常用的有人类可读的文本格式用于直观表示空间几何语法示例点经度纬度线串多边形缺点不包含信息需额外指定坐标系函数可将内部格式转为可将转为内部格式需指定二进制格式比更紧凑适合计算机传输和存储但人类不可读与对应语法相同但以二进制编码缺点同样不包含需单独处理坐标系函数转为解析并指定的扩展在文本中直接包含信息格式为示例明确指定该点属于坐标系解决了缺少的问题简化了数据交换函数转为直接解析无需单独指定基于的轻量级空间数据交换格式广泛用于地图如和接口包含几何类型坐标坐标系可选默认等信息示例经度纬度函数转为解析为内部格式由定义的格式主要用于等地理信息可视化工具支持点线面多边形等几何类型包含样式信息示例函数转为解析为内部格式其他格式不直接存储但可通过工具将导入或通过导出可通过函数将几何转为格式用于网页矢量图形总结内部存储主要使用含高效二进制外部交换人类可读无含常用工具机器友好二进制无二进制含实际使用中可根据场景选择格式如开发用数据导入用内部计算依赖举例子适合手动输入调试文本易读带坐标系适合程序间传输数据库内部存储二进制高效地图开发首选格式易被前端解析与等工具交互时使用通过工具导入导出兼容传统软件根据场景选择格式如前端展示用数据备份用程序交互用格式人类可读的文本格式无信息需手动指定坐标系示例用创建点并转换格式从文本创建对象需指定将内部存储的转为文本输出仅坐标无坐标系信息格式的扩展文本中直接包含无需额外指定示例用创建线串并解析从文本创建自带将转为文本包含输出二进制格式机器友好的二进制格式无含内部存储格式示例转换为并查看将转为二进制无输出二进制数据人类不可读类似将转为二进制含输出包含的二进制数据内部存储的就是这种格式格式开发常用基于适合前端地图展示如示例生成并解析将多边形转为输出格式化后从解析为格式用于等工具基于示例转换为格式将点转为输出格式导入导出通过提供的命令行工具处理非直接操作示例导入到命令行执行将导入到数据库需指定示例从导出为命令行执行将表中数据导出为不同格式之间的转换提供了丰富的函数用于不同空间数据格式之间的转换以下是常见格式转换的示例涵盖等之间的相互转换核心转换逻辑中所有空间格式的转换通常以或类型为中间载体格式格式文本格式内部类型从文本创建需指定将转为文本输出从文本创建自带将转为文本含输出二进制格式内部类型从二进制创建需指定将转为二进制先将转为二进制使用上面的结果从二进制创建自带将转为二进制内部存储格式常用格式类型从字符串创建默认将转为字符串输出从字符串创建默认将转为字符串输出跨格式间接转换以为中间层例如等需先转为再转目标格式示例步骤先转输出示例步骤先转输出坐标系转换变更严格来说不属于格式转换但属于空间数据处理的常见操作需先确保目标已在中注册将经纬度转为米原经纬度目标查看转换后的含新输出类似具体值取决于经纬度对应的坐标总结所有格式转换均以类型为中间层核心是掌握转为目标格式和从源格式创建系列函数带坐标系的格式如带转换时会自动保留无坐标系的格式如需手动指定实际开发中根据场景选择转换方向如前端展示用数据入库用空间数据的增删查改在中空间数据的增删查改操作与普通数据类似但需结合空间数据类型和相关函数以下是具体示例准备工作创建带空间字段的表创建表指定经纬度人口空间字段点类型为空间字段创建空间索引优化查询性能增加空间数据插入空间数据时需用函数生成对象如或等示例插入城市点数据方法用生成点经度纬度并指定北京上海广州方法用从格式插入需指定深圳方法用从格式插入自带杭州查询空间数据查询时可结合空间函数如距离计算范围筛选和普通字段筛选示例查询所有城市的基本信息和空间坐标格式转为人类可读的格式示例查询距离北京公里以内的城市用类型计算球面距离先将转为类型支持球面距离计算距离公里北京北京米公里示例查询某矩形范围内的城市如经度纬度用创建矩形范围矩形范围结果广州深圳北京上海杭州不在此范围内更新空间数据可更新空间字段的坐标或普通字段结合空间函数修改几何形状示例修改城市的坐标如调整深圳的经纬度新坐标深圳示例批量更新坐标系如从转为的先添加一个新的字段存储坐标用转换坐标系并更新从转为删除空间数据示例删除指定城市杭州示例删除人口少于万的城市结果删除人口小于万的城市假设示例中只有杭州被删除其他均超过总结增加用等函数生成对象插入查询结合转换格式距离范围等空间函数更新通过空间函数修改字段的值或用转换坐标系删除与普通一致按条件删除记录核心是利用函数处理空间数据的特殊性同时为空间字段创建索引以提升查询效率常用基础空间查询函数的使用提供了丰富的空间查询函数用于处理几何对象的关系测量转换等操作以下是最常用的基础空间查询函数及其使用示例基于或类型一几何关系查询函数用于判断两个几何对象之间的空间关系如包含相交相邻等遵循简单要素规范判断是否完全包含的所有点都在内示例查询广东省多边形完全包含的城市点假设有表多边形和表点均为广东省判断和是否存在交集至少有一个共同点示例查询与珠江线串相交的城市珠江判断和之间的最短距离是否小于等于单位取决于用坐标单位用米示例查询距离上海公里以内的城市用类型计算球面距离上海上海米公里判断和是否边界相交但内部不重叠如相邻的两个多边形共享一条边示例查询与北京市多边形边界相邻的城市北京市二测量计算函数用于计算几何对象的距离长度面积等计算和之间的最短距离返回平面距离返回球面距离示例计算北京到上海的球面距离公里北京上海计算线串或多线串的长度单位同示例计算长江的总长度公里长江计算多边形或多多边形的面积返回平面面积返回球面面积示例计算青海省的面积平方公里平方公里平方米青海省计算多边形的周长单位同长度示例计算海南岛多边形的周长公里海南岛三几何转换与提取函数用于转换几何类型或提取几何对象的部分信息将转为人类可读的文本格式或示例查询城市坐标的和格式北京计算多边形或线串的几何中心质心示例计算浙江省的省会质心点浙江省将几何对象从当前转换为目标需确保目标已注册示例将北京的经纬度转为坐标北京以为中心生成指定距离的缓冲区单位同示例生成以上海为中心半径公里的缓冲区用于范围筛选创建上海公里缓冲区并查询缓冲区内的城市上海四几何属性查询函数用于获取几何对象的基本属性返回几何对象的具体类型如示例查询表中所有几何类型返回几何对象的空间参考标识符示例检查城市表的是否为返回线串或多边形的顶点数量示例查询某条道路线串的顶点数长安街五总结关系查询是判断空间关系的核心函数常用于筛选符合条件的对象测量计算用于量化几何属性注意和类型的单位差异转换提取用于坐标系转换用于格式转换用于范围扩展属性查询用于验证几何对象的基本信息使用时需根据数据的类型平面球面选择合适的函数并结合空间索引提升查询效率常用分析函数的使用提供了一系列用于空间分析的函数可用于解决缓冲区分析叠加分析网络分析密度分析等常见空间问题以下是常用分析函数的分类及使用示例一缓冲区分析通过生成几何对象的缓冲区用于范围筛选影响区域分析等函数功能以为中心生成半径为的缓冲区类型用坐标单位类型用米示例分析某地铁站米范围内的公交站假设坐标单位为米地铁站表和公交站表人民广场站地铁站的米缓冲区与公交站相交二叠加分析对多个几何对象进行叠加计算生成新的几何或属性如交集并集差异等功能返回和的交集重叠部分的几何示例计算上海市与长江的重叠区域河流穿过城市的部分上海市长江功能返回和的并集合并后的几何示例合并东城区和西城区的多边形为一个整体东城区西城区功能返回中减去与重叠的部分独有的区域示例计算北京市除去密云水库后的区域剩余面积平方公里北京市密云水库三最近邻分析查找距离目标对象最近的几何常用于最近设施查询函数组合排序示例查找距离天安门最近的个地铁站球面距离公里天安门取最近的个优化先过滤范围减少计算量天安门先筛选公里内的候选再排序效率更高四密度分析通过或等函数分析要素在空间上的分布密度如人口密度设施密度生成网格并统计密度示例在上海市范围内生成的六边形网格统计每个网格内的便利店数量生成覆盖上海市的六边形网格单位米米网格基于上海范围上海市统计每个网格内的便利店数量转换便利店坐标到网格核密度估计需函数基于点要素生成连续密度表面计算上海市范围内的人口核密度假设人口点数据在表带宽米影响范围输出分辨率像素上海市五网络分析基于线串网络如道路管线的分析需结合扩展基础函数可辅助预处理线串拆分与节点提取函数拆分线串提取线串所有节点示例将主干道线串按交叉点拆分为路段提取所有道路的交叉点主干道按交叉点拆分主干道为路段主干道最短路径需先安装扩展创建网络拓扑示例从点到点的最短路径基于道路长度道路网络带长度成本起点最近节点终点最近节点六空间聚合分析对空间数据按几何范围或属性进行聚合如按行政区统计数量平均值函数聚合几何合并几何结合城市数量平均人口聚合所有城市点为多点几何城市在省份内七总结缓冲区分析是核心用于范围影响评估叠加分析处理多几何间的空间关系最近邻分析通过排序或筛选高效查找最近要素密度分析生成网格统计密度生成连续密度表面网络分析基础函数辅助预处理结合实现路径计算聚合分析结合和几何聚合函数实现空间维度的统计分析实际应用中需根据数据类型和场景选择函数并注意坐标系单位对计算结果的影响如米度月日第二天晓磊哥帮忙部署了代码目前主要是熟悉一下公司项目代码",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-10-10 15:28:13",postMainColor:""}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:(e,t,a)=>{if(0===a)return;const o={value:t,expiry:Date.now()+864e5*a};localStorage.setItem(e,JSON.stringify(o))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const a=JSON.parse(t);if(!(Date.now()>a.expiry))return a.value;localStorage.removeItem(e)}},e.getScript=(e,t={})=>new Promise(((a,o)=>{const c=document.createElement("script");c.src=e,c.async=!0,c.onerror=o,c.onload=c.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(c.onload=c.onreadystatechange=null,a())},Object.keys(t).forEach((e=>{c.setAttribute(e,t[e])})),document.head.appendChild(c)})),e.getCSS=(e,t=!1)=>new Promise(((a,o)=>{const c=document.createElement("link");c.rel="stylesheet",c.href=e,t&&(c.id=t),c.onerror=o,c.onload=c.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(c.onload=c.onreadystatechange=null,a())},document.head.appendChild(c)})),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#18171d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#f7f9fe")};const t=saveToLocal.get("theme"),a=window.matchMedia("(prefers-color-scheme: dark)").matches,o=window.matchMedia("(prefers-color-scheme: light)").matches,c=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!a&&!o&&!c;if(void 0===t){if(o)activateLightMode();else if(a)activateDarkMode();else if(c||n){const e=(new Date).getHours();e<=6||e>=18?activateDarkMode():activateLightMode()}window.matchMedia("(prefers-color-scheme: dark)").addListener((e=>{void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode():activateLightMode())}))}else"light"===t?activateLightMode():activateDarkMode();const d=saveToLocal.get("aside-status");void 0!==d&&("hide"===d?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="https://jsd-proxy.ygxz.in/npm/js-heo@1.0.11/poem/poem.min.css"><link rel="stylesheet" href="https://jsd-proxy.ygxz.in/npm/js-heo@1.0.11/mainColor/heoMainColor.min.css"><link rel="stylesheet" href="https://jsd-proxy.ygxz.in/gh/lyay23/blogstatic@v1.0.0/static/essay-style.min.css"><link rel="stylesheet" href="https://jsd-proxy.ygxz.in/gh/lyay23/blogstatic@v1.0.0/static/todolist.min.css"><link rel="stylesheet" href="https://jsd-proxy.ygxz.in/gh/lyay23/blogstatic@v1.0.1/static/custom-me.min.css"><link rel="stylesheet" href="https://jsd-proxy.ygxz.in/gh/lyay23/blogstatic@v1.0.0/static/imgloaded.min.css"><link rel="stylesheet" href="https://jsd-proxy.ygxz.in/gh/lyay23/blogstatic@v1.0.0/static/twikoo.min.css"><script async defer src="https://umami.baskly.fun/script.js" data-website-id="83445f1f-eab2-4423-b52a-d98fcec8638f"></script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://bu.dusays.com/2025/03/01/67c2609b7c10b.jpg"><div class="loading-image-dot"></div></div></div><script>const preloader={endLoading:()=>{document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",(()=>{preloader.endLoading()})),setTimeout((function(){preloader.endLoading()}),1e4),document.addEventListener("pjax:send",(()=>{preloader.initLoading()})),document.addEventListener("pjax:complete",(()=>{preloader.endLoading()}))</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">李阳的秘密小屋</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i> <span>隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i> <span>分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i> <span>标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tongji1"></use></svg> <span>统计</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=12781955100&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i> <span>耳机分你一半</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i> <span>留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-zuji"></use></svg> <span>脚步</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/essay/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-taiyang"></use></svg> <span>小太阳</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-a-xiaoyangyang_huaban1"></use></svg> <span>了解我</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i> <span>搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/408/" style="font-size:1.05rem">408<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size:1.05rem">C语言<sup>1</sup></a><a href="/tags/java/" style="font-size:1.05rem">java<sup>1</sup></a><a href="/tags/javaweb/" style="font-size:1.05rem">javaweb<sup>8</sup></a><a href="/tags/%E5%8A%9B%E6%89%A3%E5%88%B7%E9%A2%98/" style="font-size:1.05rem">力扣刷题<sup>1</sup></a><a href="/tags/%E5%AE%9E%E4%B9%A0/" style="font-size:1.05rem">实习<sup>3</sup></a><a href="/tags/%E5%AE%9E%E4%B9%A0%E7%AF%87/" style="font-size:1.05rem">实习篇<sup>1</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size:1.05rem">操作系统<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size:1.05rem">数据结构<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" style="font-size:1.05rem">计算机组成原理<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size:1.05rem">计算机网络<sup>2</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/" style="font-size:1.05rem">软件工程<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size:1.05rem">面试<sup>4</sup></a></div></div><hr></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多"><i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">十月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">八月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url">实习</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%AE%9E%E4%B9%A0/" tabindex="-1" itemprop="url"><span><i class="anzhiyufont anzhiyu-icon-hashtag"></i> 实习</span></a></span></div></div><h1 class="post-title" itemprop="name headline">实习日志</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-10-09T01:34:21.000Z" title="发表于 2025-10-09 09:34:21">2025-10-09</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-10-10T07:28:13.641Z" title="更新于 2025-10-10 15:28:13">2025-10-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">8.1k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>32分钟</span></span><span class="post-meta-separator"></span><span data-flag-title="实习日志"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="twikoo_visitors" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"></span><span class="post-meta-position" title="作者IP属地为武汉"><i class="anzhiyufont anzhiyu-icon-location-dot"></i> 武汉</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/65070/#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://bu.dusays.com/2024/11/24/674340e1191e4.png?_r_=4df18ead-b896-9763-5b8b-8b2b8754a0cf"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://blog.baskly.fun/posts/65070/"><header><a class="post-meta-categories" href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url">实习</a><a href="/tags/%E5%AE%9E%E4%B9%A0/" tabindex="-1" itemprop="url">实习</a><h1 id="CrawlerTitle" itemprop="name headline">实习日志</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">李阳</span><time itemprop="dateCreated datePublished" datetime="2025-10-09T01:34:21.000Z" title="发表于 2025-10-09 09:34:21">2025-10-09</time><time itemprop="dateCreated datePublished" datetime="2025-10-10T07:28:13.641Z" title="更新于 2025-10-10 15:28:13">2025-10-10</time></header><h1>10月9日 第一天</h1><blockquote><p>工作内容：</p><p>postgis，今天主要了解空间数据类型有哪些；空间数据格式有哪些，不同格式之间的转换；空间数据的增删查改；常用基础空间查询函数的使用；常用分析函数的使用。</p></blockquote><h2 id="工作收获">工作收获</h2><h3 id="空间函数的数据类型有哪些">空间函数的数据类型有哪些</h3><p>PostGIS 作为 PostgreSQL 的空间扩展，定义了一系列用于处理空间数据的特殊数据类型，这些类型是空间函数操作的基础。以下是 PostGIS 中主要的空间数据类型分类及说明：</p><h4 id="1-基本几何类型（Geometry）">1. 基本几何类型（Geometry）</h4><p><code>geometry</code> 是 PostGIS 中最核心的空间数据类型，用于表示二维平面上的几何对象，遵循 <strong>OGC 简单要素规范（SFS）</strong>，支持以下子类型：</p><ul><li><strong>点（Point）</strong>：零维对象，表示单个坐标点（如 <code>POINT(1 2)</code>）。</li><li><strong>线串（LineString）</strong>：一维对象，由多个点连接成的线段（如 <code>LINESTRING(0 0, 1 1, 2 0)</code>）。</li><li><strong>多边形（Polygon）</strong>：二维对象，由闭合线串及内部区域组成（如 <code>POLYGON((0 0, 0 1, 1 1, 1 0, 0 0))</code>）。</li><li><strong>多点（MultiPoint）</strong>：多个点的集合（如 <code>MULTIPOINT(1 2, 3 4)</code>）。</li><li><strong>多线串（MultiLineString）</strong>：多个线串的集合（如 <code>MULTILINESTRING((0 0,1 1), (2 2,3 3))</code>）。</li><li><strong>多 polygon（MultiPolygon）</strong>：多个多边形的集合（如 <code>MULTIPOLYGON(((0 0,0 1,1 1,1 0,0 0)), ((2 2,2 3,3 3,3 2,2 2)))</code>）。</li><li><strong>几何集合（GeometryCollection）</strong>：多种几何类型的混合集合（如 <code>GEOMETRYCOLLECTION(POINT(1 2), LINESTRING(0 0,1 1))</code>）。</li></ul><p>每个 <code>geometry</code> 对象都包含 <strong>空间参考系（SRID）</strong>，用于定义坐标的投影和单位（如 WGS84 对应 SRID=4326）。</p><h4 id="2-地理类型（Geography）">2. 地理类型（Geography）</h4><p><code>geography</code> 类型用于表示椭球面上的地理数据（如地球表面的经纬度坐标），与 <code>geometry</code> 的主要区别：</p><ul><li>基于球面计算距离、面积等（而非平面），结果更符合实际地理场景（如地球曲率影响）。</li><li>支持的子类型与 <code>geometry</code> 一致（点、线串、多边形等），但隐含 SRID 为 WGS84（4326，经纬度坐标），也可指定其他椭球坐标系。</li><li>计算成本高于 <code>geometry</code>，适合大范围（跨半球）数据，小范围数据常用 <code>geometry</code>。</li></ul><h4 id="3-三维与测量类型">3. 三维与测量类型</h4><p>PostGIS 支持带 Z 坐标（三维）和 M 坐标（测量值，如时间、距离）的扩展类型：</p><ul><li><strong>3D 几何</strong>：在基本类型后加 <code>Z</code>，如 <code>PointZ</code>（三维点）、<code>LineStringZ</code>（三维线串），表示包含高程信息的对象。</li><li><strong>测量几何</strong>：加 <code>M</code>，如 <code>PointM</code>（带测量值的点）、<code>LineStringZM</code>（三维 + 测量值的线串）。</li></ul><h4 id="4-其他辅助类型">4. 其他辅助类型</h4><ul><li><strong>BOX2D</strong>：二维边界框，表示 <code>geometry</code> 的最小外接矩形（如 <code>BOX2D(0 0, 1 1)</code>）。</li><li><strong>BOX3D</strong>：三维边界框，包含 Z 坐标的最小外接立方体。</li><li><strong>GID</strong>：部分函数返回的几何 ID（非标准类型，较少直接使用）。</li><li><strong>Raster</strong>：栅格数据类型（需启用 PostGIS Raster 扩展），用于处理影像、遥感数据等。</li></ul><h4 id="5-总结">5. 总结</h4><p>PostGIS 的空间函数主要操作 <code>geometry</code> 和 <code>geography</code> 两大核心类型，其中 <code>geometry</code> 适用于平面投影数据，<code>geography</code> 适用于球面地理数据，两者均支持点、线、面等基本几何形态及三维 / 测量扩展。选择类型时需根据数据的空间尺度、投影方式及计算需求决定。</p><h4 id="6-使用举例">6. 使用举例</h4><blockquote><p><strong><code>geometry</code></strong>：平面坐标，适合小范围，计算快（如城市内建筑、道路）。</p><p><strong><code>geography</code></strong>：球面坐标，适合大范围，结果更精确（如跨国距离、全球城市）。</p><p><strong>Z/M 类型</strong>：扩展维度，用于高程、时间等附加信息（如山峰海拔、路线距离）。</p><p><strong>边界框</strong>：辅助快速范围查询，优化性能。</p></blockquote><h5 id="1-基本几何类型（geometry）">1. 基本几何类型（<code>geometry</code>）</h5><p>适用于平面坐标（如 utm 投影、地方坐标系），计算效率高，适合小范围（如城市、园区）数据。</p><p><strong>示例 1：创建点（Point）并查询距离</strong></p><p>假设某城市使用 utm 投影（SRID=32650，单位米），存储两个建筑的坐标：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建测试表（带SRID约束）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> buildings (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name TEXT,</span><br><span class="line">    geom geometry(Point, <span class="number">32650</span>)  <span class="comment">-- 明确类型为Point，SRID=32650</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据（坐标单位为米）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> buildings (id, name, geom) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;图书馆&#x27;</span>, ST_SetSRID(ST_MakePoint(<span class="number">300000</span>, <span class="number">4000000</span>), <span class="number">32650</span>)),  <span class="comment">-- ST_MakePoint生成点，ST_SetSRID指定坐标系</span></span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;体育馆&#x27;</span>, ST_SetSRID(ST_MakePoint(<span class="number">300100</span>, <span class="number">4000200</span>), <span class="number">32650</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算两点距离（平面距离，单位米）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_Distance(b1.geom, b2.geom) <span class="keyword">AS</span> distance_m</span><br><span class="line"><span class="keyword">FROM</span> buildings b1, buildings b2</span><br><span class="line"><span class="keyword">WHERE</span> b1.id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> b2.id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">-- 结果约为 223.607 米（勾股定理：√(100² + 200²)）</span></span><br></pre></td></tr></table></figure><p><strong>示例 2：创建多边形（Polygon）并判断包含关系</strong></p><p>存储一个园区的边界，判断某点是否在园区内：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建园区表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> parks (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name TEXT,</span><br><span class="line">    geom geometry(Polygon, <span class="number">32650</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入园区边界（闭合多边形，坐标按顺时针/逆时针顺序）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> parks (id, name, geom) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;中央公园&#x27;</span>, ST_SetSRID(ST_MakePolygon(</span><br><span class="line">    ST_GeomFromText(<span class="string">&#x27;LINESTRING(299900 3999900, 300100 3999900, 300100 4000100, 299900 4000100, 299900 3999900)&#x27;</span>)</span><br><span class="line">), <span class="number">32650</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 判断图书馆是否在公园内（使用ST_Contains）</span></span><br><span class="line"><span class="keyword">SELECT</span> p.name, ST_Contains(p.geom, b.geom) <span class="keyword">AS</span> is_inside</span><br><span class="line"><span class="keyword">FROM</span> parks p, buildings b</span><br><span class="line"><span class="keyword">WHERE</span> p.id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> b.id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 结果：t（true，图书馆在公园内）</span></span><br></pre></td></tr></table></figure><h5 id="2-地理类型（geography）">2. 地理类型（<code>geography</code>）</h5><p>适用于球面坐标（经纬度，SRID=4326），计算结果考虑地球曲率，适合大范围（如跨国、全球）数据。</p><p><strong>示例：计算两地球面距离（经纬度）</strong></p><p>存储两个城市的经纬度，计算实际地表距离：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建城市表（geography类型默认SRID=4326，单位度）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> cities (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name TEXT,</span><br><span class="line">    geog geography(Point)  <span class="comment">-- 无需显式指定SRID，默认WGS84经纬度</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据（经度,纬度）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> cities (id, name, geog) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;北京&#x27;</span>, ST_MakePoint(<span class="number">116.4074</span>, <span class="number">39.9042</span>)::geography),  <span class="comment">-- 经纬度转geography</span></span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;上海&#x27;</span>, ST_MakePoint(<span class="number">121.4737</span>, <span class="number">31.2304</span>)::geography);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算球面距离（单位米，自动考虑地球曲率）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_Distance(c1.geog, c2.geog) <span class="operator">/</span> <span class="number">1000</span> <span class="keyword">AS</span> distance_km</span><br><span class="line"><span class="keyword">FROM</span> cities c1, cities c2</span><br><span class="line"><span class="keyword">WHERE</span> c1.id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> c2.id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">-- 结果约为 1317 公里（接近实际公路距离）</span></span><br></pre></td></tr></table></figure><h5 id="3-三维与测量类型（Z-M-坐标）">3. 三维与测量类型（Z/M 坐标）</h5><p>用于包含高程（Z）或附加测量值（如时间、温度）的场景。</p><p><strong>示例：三维点（PointZ）存储海拔</strong></p><p>记录山峰的经纬度和海拔：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> mountains (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name TEXT,</span><br><span class="line">    geom geometry(PointZ, <span class="number">4326</span>)  <span class="comment">-- 三维点，SRID=4326（经纬度+海拔）</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据（经度,纬度,海拔米）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> mountains (id, name, geom) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;珠穆朗玛峰&#x27;</span>, ST_SetSRID(ST_MakePoint(<span class="number">86.9250</span>, <span class="number">27.9881</span>, <span class="number">8848.86</span>), <span class="number">4326</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询海拔（提取Z坐标）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, ST_Z(geom) <span class="keyword">AS</span> elevation_m <span class="keyword">FROM</span> mountains <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 结果：8848.86 米</span></span><br></pre></td></tr></table></figure><p><strong>示例：带测量值的线串（LineStringM）</strong></p><p>记录一条 hiking 路线的经纬度和累计距离（M 值）：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> hiking_routes (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name TEXT,</span><br><span class="line">    geom geometry(LineStringM, <span class="number">4326</span>)  <span class="comment">-- 线串+测量值（距离）</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入路线：点依次为起点、中途点、终点，M值为累计距离（公里）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> hiking_routes (id, name, geom) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;香山步道&#x27;</span>, ST_SetSRID(</span><br><span class="line">    ST_GeomFromText(<span class="string">&#x27;LINESTRINGM(116.191 39.998 0, 116.202 40.003 1.5, 116.210 40.009 3.2)&#x27;</span>),</span><br><span class="line">    <span class="number">4326</span></span><br><span class="line">));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提取中途点的距离（M值）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_M(ST_PointN(geom, <span class="number">2</span>)) <span class="keyword">AS</span> distance_km  <span class="comment">-- ST_PointN取第2个点，ST_M取M值</span></span><br><span class="line"><span class="keyword">FROM</span> hiking_routes <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 结果：1.5 公里</span></span><br></pre></td></tr></table></figure><h5 id="4-边界框类型（BOX2D-BOX3D）">4. 边界框类型（BOX2D/BOX3D）</h5><p>用于快速范围查询，避免复杂几何计算。</p><p><strong>示例：用 BOX2D 筛选范围内的点</strong></p><p>查询某矩形区域内的建筑：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 定义查询范围：左下角(299950, 3999950)，右上角(300050, 4000050)（utm坐标）</span></span><br><span class="line"><span class="keyword">SELECT</span> b.name, ST_AsText(b.geom) <span class="keyword">AS</span> coordinates</span><br><span class="line"><span class="keyword">FROM</span> buildings b</span><br><span class="line"><span class="keyword">WHERE</span> ST_Intersects(b.geom, ST_MakeEnvelope(<span class="number">299950</span>, <span class="number">3999950</span>, <span class="number">300050</span>, <span class="number">4000050</span>, <span class="number">32650</span>));</span><br><span class="line"><span class="comment">-- 结果：返回图书馆（坐标300000,4000000在范围内）</span></span><br></pre></td></tr></table></figure><blockquote><p><code>ST_MakeEnvelope</code> 生成 <code>BOX2D</code> 边界框，<code>ST_Intersects</code> 判断几何是否与边界框相交，效率高于直接用多边形判断。</p></blockquote><h3 id="空间数据格式有哪些">空间数据格式有哪些</h3><p>在 PostGIS 中，空间数据的 “格式” 通常指数据的<strong>存储格式</strong>和<strong>序列化格式</strong>（用于数据输入、输出或交换）。以下是主要的空间数据格式分类及说明：</p><h4 id="1-存储格式（数据库内部存储）">1. 存储格式（数据库内部存储）</h4><p>PostGIS 在 PostgreSQL 中存储空间数据时，采用高效的二进制格式，主要包括：</p><ol><li><p><strong>EWKB（Extended Well-Known Binary）</strong></p><ul><li>是 PostGIS 内部存储空间数据的<strong>原生格式</strong>，基于 OGC 标准的 WKB（Well-Known Binary）扩展而来。</li><li>相比 WKB，EWKB 增加了<strong>SRID（空间参考标识符）</strong> 的存储，能直接关联坐标系信息（而 WKB 本身不包含 SRID）。</li><li>二进制格式紧凑，读写效率高，适合数据库内部存储和快速计算。</li><li>示例：PostGIS 表中 <code>geometry</code> 或 <code>geography</code> 类型的字段值，本质上就是 EWKB 编码的二进制数据。</li></ul></li><li><p><strong>GEOGRAPHY 类型的存储</strong></p><ul><li><code>geography</code> 类型本质上也是以 EWKB 格式存储，但隐含默认 SRID=4326（WGS84 经纬度），且存储的坐标是经纬度（度）而非平面坐标（米）</li></ul></li></ol><h4 id="2-序列化格式（输入-输出-交换格式）">2. 序列化格式（输入 / 输出 / 交换格式）</h4><p>在与外部系统交互（如导入、导出、查询返回）时，PostGIS 支持多种文本或二进制格式，常用的有：</p><ol><li><p><strong>WKT（Well-Known Text）</strong></p><ul><li>人类可读的文本格式，用于直观表示空间几何。</li><li>语法示例：<ul><li>点：<code>POINT(116.4 39.9)</code>（经度，纬度）</li><li>线串：<code>LINESTRING(0 0, 1 1, 2 0)</code></li><li>多边形：<code>POLYGON((0 0, 0 1, 1 1, 1 0, 0 0))</code></li></ul></li><li>缺点：不包含 SRID 信息，需额外指定坐标系。</li><li>PostGIS 函数：<code>ST_AsText(geom)</code> 可将内部格式转为 WKT；<code>ST_GeomFromText(wkt, srid)</code> 可将 WKT 转为内部格式（需指定 SRID）。</li></ul></li><li><p><strong>WKB（Well-Known Binary）</strong></p><ul><li>二进制格式，比 WKT 更紧凑，适合计算机传输和存储（但人类不可读）。</li><li>与 WKT 对应，语法相同但以二进制编码。</li><li>缺点：同样不包含 SRID，需单独处理坐标系。</li><li>PostGIS 函数：<code>ST_AsBinary(geom)</code> 转为 WKB；<code>ST_GeomFromWKB(wkb, srid)</code> 解析 WKB 并指定 SRID。</li></ul></li><li><p><strong>EWKT（Extended Well-Known Text）</strong></p><ul><li>WKT 的扩展，在文本中直接包含 SRID 信息，格式为 <code>SRID=srid;geometry</code>。</li><li>示例：<code>SRID=4326;POINT(116.4 39.9)</code>（明确指定该点属于 WGS84 坐标系）。</li><li>解决了 WKT 缺少 SRID 的问题，简化了数据交换。</li><li>PostGIS 函数：<code>ST_AsEWKT(geom)</code> 转为 EWKT；<code>ST_GeomFromEWKT(ewkt)</code> 直接解析 EWKT（无需单独指定 SRID）。</li></ul></li><li><p><strong>GeoJSON</strong></p><ul><li><p>基于 JSON 的轻量级空间数据交换格式，广泛用于 Web 地图（如 Leaflet、OpenLayers）和 API 接口。</p></li><li><p>包含几何类型、坐标、坐标系（可选，默认 WGS84）等信息。</p></li><li><p>示例：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Point&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;coordinates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">116.4</span><span class="punctuation">,</span> <span class="number">39.9</span><span class="punctuation">]</span>  <span class="comment">// [经度, 纬度]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>PostGIS 函数：<code>ST_AsGeoJSON(geom)</code> 转为 GeoJSON；<code>ST_GeomFromGeoJSON(geojson)</code> 解析 GeoJSON 为内部格式。</p></li></ul></li><li><p><strong>KML</strong></p><ul><li><p>由 Google 定义的 XML 格式，主要用于 Google Earth 等地理信息可视化工具。</p></li><li><p>支持点、线、面、多边形等几何类型，包含样式信息。</p></li><li><p>示例：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Point</span>&gt;</span><span class="tag">&lt;<span class="name">coordinates</span>&gt;</span>116.4,39.9<span class="tag">&lt;/<span class="name">coordinates</span>&gt;</span><span class="tag">&lt;/<span class="name">Point</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>PostGIS 函数：<code>ST_AsKML(geom)</code> 转为 KML；<code>ST_GeomFromKML(kml)</code> 解析 KML 为内部格式。</p></li></ul></li><li><p><strong>其他格式</strong></p><ul><li><strong>Shapefile</strong>：PostGIS 不直接存储，但可通过 <code>shp2pgsql</code> 工具将 Shapefile 导入 PostGIS，或通过 <code>pgsql2shp</code> 导出。</li><li><strong>SVG</strong>：可通过 <code>ST_AsSVG</code> 函数将几何转为 SVG 格式，用于网页矢量图形。</li></ul></li></ol><h4 id="3-总结">3. 总结</h4><ul><li><strong>内部存储</strong>：主要使用 EWKB（含 SRID，高效二进制）。</li><li>外部交换：<ul><li>人类可读：WKT（无 SRID）、EWKT（含 SRID）、GeoJSON（Web 常用）、KML（Google 工具）。</li><li>机器友好：WKB（二进制，无 SRID）、EWKB（二进制，含 SRID）。</li></ul></li></ul><p>实际使用中，可根据场景选择格式（如 Web 开发用 GeoJSON，数据导入用 EWKT，内部计算依赖 EWKB）。</p><h4 id="4-举例子">4. 举例子</h4><blockquote><p><strong>WKT/EWKT</strong>：适合手动输入、调试（文本易读，EWKT 带坐标系）。</p><p><strong>WKB/EWKB</strong>：适合程序间传输、数据库内部存储（二进制高效）。</p><p><strong>GeoJSON</strong>：Web 地图开发首选（JSON 格式易被前端解析）。</p><p><strong>KML</strong>：与 Google Earth 等工具交互时使用。</p><p><strong>Shapefile</strong>：通过工具导入导出，兼容传统 GIS 软件。</p><p>根据场景选择格式（如前端展示用 GeoJSON，数据备份用 EWKT，程序交互用 WKB）。</p></blockquote><h5 id="1-WKT（Well-Known-Text）格式">1. WKT（Well-Known Text）格式</h5><p>人类可读的文本格式，无 SRID 信息，需手动指定坐标系。</p><p><strong>示例：用 WKT 创建点并转换格式</strong></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 从 WKT 文本创建 geometry 对象（需指定 SRID=4326）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_GeomFromText(<span class="string">&#x27;POINT(116.4074 39.9042)&#x27;</span>, <span class="number">4326</span>) <span class="keyword">AS</span> geom_wkt;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 将内部存储的 geometry 转为 WKT 文本</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsText(ST_GeomFromText(<span class="string">&#x27;POINT(116.4074 39.9042)&#x27;</span>, <span class="number">4326</span>)) <span class="keyword">AS</span> wkt_result;</span><br><span class="line"><span class="comment">-- 输出：POINT(116.4074 39.9042)（仅坐标，无坐标系信息）</span></span><br></pre></td></tr></table></figure><h5 id="2-EWKT（Extended-WKT）格式">2. EWKT（Extended WKT）格式</h5><p>WKT 的扩展，文本中直接包含 SRID，无需额外指定。</p><p><strong>示例：用 EWKT 创建线串并解析</strong></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 从 EWKT 文本创建 geometry（自带 SRID=32650）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_GeomFromEWKT(<span class="string">&#x27;SRID=32650;LINESTRING(300000 4000000, 300100 4000200)&#x27;</span>) <span class="keyword">AS</span> geom_ewkt;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 将 geometry 转为 EWKT 文本（包含 SRID）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsEWKT(ST_GeomFromEWKT(<span class="string">&#x27;SRID=32650;LINESTRING(300000 4000000, 300100 4000200)&#x27;</span>)) <span class="keyword">AS</span> ewkt_result;</span><br><span class="line"><span class="comment">-- 输出：SRID=32650;LINESTRING(300000 4000000,300100 4000200)</span></span><br></pre></td></tr></table></figure><h5 id="3-WKB-EWKB（二进制格式）">3. WKB/EWKB（二进制格式）</h5><p>机器友好的二进制格式，WKB 无 SRID，EWKB 含 SRID（PostGIS 内部存储格式）。</p><p><strong>示例：转换为 WKB/EWKB 并查看</strong></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 将 geometry 转为 WKB（二进制，无 SRID）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsBinary(ST_GeomFromText(<span class="string">&#x27;POINT(116.4 39.9)&#x27;</span>, <span class="number">4326</span>)) <span class="keyword">AS</span> wkb_result;</span><br><span class="line"><span class="comment">-- 输出：二进制数据（人类不可读，类似 \x0101000000...）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 将 geometry 转为 EWKB（二进制，含 SRID）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsEWKB(ST_GeomFromText(<span class="string">&#x27;POINT(116.4 39.9)&#x27;</span>, <span class="number">4326</span>)) <span class="keyword">AS</span> ewkb_result;</span><br><span class="line"><span class="comment">-- 输出：包含 SRID 的二进制数据（PostGIS 内部存储的就是这种格式）</span></span><br></pre></td></tr></table></figure><h5 id="4-GeoJSON-格式">4. GeoJSON 格式</h5><p>Web 开发常用，基于 JSON，适合前端地图展示（如 Leaflet、OpenLayers）。</p><p><strong>示例：生成 GeoJSON 并解析</strong></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 将多边形转为 GeoJSON</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsGeoJSON(</span><br><span class="line">  ST_GeomFromText(<span class="string">&#x27;POLYGON((116.3 39.8, 116.4 39.8, 116.4 39.9, 116.3 39.9, 116.3 39.8))&#x27;</span>, <span class="number">4326</span>)</span><br><span class="line">) <span class="keyword">AS</span> geojson_result;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 输出（格式化后）：</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;type&quot;: &quot;Polygon&quot;,</span><br><span class="line">  &quot;coordinates&quot;: [</span><br><span class="line">    [</span><br><span class="line">      [<span class="number">116.3</span>, <span class="number">39.8</span>],</span><br><span class="line">      [<span class="number">116.4</span>, <span class="number">39.8</span>],</span><br><span class="line">      [<span class="number">116.4</span>, <span class="number">39.9</span>],</span><br><span class="line">      [<span class="number">116.3</span>, <span class="number">39.9</span>],</span><br><span class="line">      [<span class="number">116.3</span>, <span class="number">39.8</span>]</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 从 GeoJSON 解析为 geometry</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_GeomFromGeoJSON(<span class="string">&#x27;&#123;&quot;type&quot;:&quot;Point&quot;,&quot;coordinates&quot;:[116.4,39.9]&#125;&#x27;</span>) <span class="keyword">AS</span> geom_from_geojson;</span><br></pre></td></tr></table></figure><h5 id="5-KML格式">5. KML格式</h5><p>用于 Google Earth 等工具，基于 XML。</p><p><strong>示例：转换为 KML 格式</strong></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">-- 将点转为 KML</span><br><span class="line">SELECT ST_AsKML(ST_GeomFromText(&#x27;POINT(<span class="number">116.4074</span> <span class="number">39.9042</span>)&#x27;<span class="punctuation">,</span> <span class="number">4326</span>)) AS kml_result;</span><br><span class="line">-- 输出：&lt;Point&gt;&lt;coordinates&gt;<span class="number">116.4074</span><span class="punctuation">,</span><span class="number">39.9042</span><span class="punctuation">,</span><span class="number">0</span>&lt;/coordinates&gt;&lt;/Point&gt;</span><br></pre></td></tr></table></figure><h5 id="6-Shapefile-格式（导入-导出）">6. Shapefile 格式（导入 / 导出）</h5><p>通过 PostGIS 提供的命令行工具处理（非 SQL 直接操作）。</p><p><strong>示例：导入 Shapefile 到 PostGIS</strong></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 命令行执行：将 buildings.shp 导入到数据库（需指定 SRID<span class="operator">=</span><span class="number">32650</span>）</span><br><span class="line">shp2pgsql <span class="operator">-</span>s <span class="number">32650</span> <span class="operator">-</span>I buildings.shp public.buildings <span class="operator">|</span> psql <span class="operator">-</span>d your_db <span class="operator">-</span>U your_user</span><br></pre></td></tr></table></figure><p><strong>示例：从 PostGIS 导出为 Shapefile</strong></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 命令行执行：将表中数据导出为 Shapefile</span><br><span class="line">pgsql2shp <span class="operator">-</span>f export_buildings <span class="operator">-</span>h localhost <span class="operator">-</span>u your_user your_db &quot;SELECT * FROM buildings&quot;</span><br></pre></td></tr></table></figure><h3 id="不同格式之间的转换">不同格式之间的转换</h3><p>PostGIS 提供了丰富的函数用于不同空间数据格式之间的转换，以下是常见格式转换的示例，涵盖 WKT、EWKT、WKB、EWKB、GeoJSON、KML 等之间的相互转换：</p><p><strong>核心转换逻辑</strong></p><p>PostGIS 中所有空间格式的转换，通常以 <strong><code>geometry</code> 或 <code>geography</code> 类型</strong>为中间载体：<code>格式A → geometry → 格式B</code></p><h4 id="1-文本格式-↔-内部-geometry-类型">1. 文本格式 ↔ 内部 geometry 类型</h4><h5 id="1-WKT-↔-geometry">1. WKT ↔ geometry</h5><ul><li><code>ST_GeomFromText(wkt, srid)</code>：从 WKT 文本创建 geometry（需指定 SRID）。</li><li><code>ST_AsText(geom)</code>：将 geometry 转为 WKT 文本。</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- WKT → geometry</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_GeomFromText(<span class="string">&#x27;POINT(116.4 39.9)&#x27;</span>, <span class="number">4326</span>) <span class="keyword">AS</span> geom;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- geometry → WKT</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsText(ST_GeomFromText(<span class="string">&#x27;POINT(116.4 39.9)&#x27;</span>, <span class="number">4326</span>)) <span class="keyword">AS</span> wkt;</span><br><span class="line"><span class="comment">-- 输出：POINT(116.4 39.9)</span></span><br></pre></td></tr></table></figure><h5 id="2-EWKT-↔-geometry">2. EWKT ↔ geometry</h5><ul><li><code>ST_GeomFromEWKT(ewkt)</code>：从 EWKT 文本创建 geometry（EWKT 自带 SRID）。</li><li><code>ST_AsEWKT(geom)</code>：将 geometry 转为 EWKT 文本（含 SRID）。</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- EWKT → geometry</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_GeomFromEWKT(<span class="string">&#x27;SRID=32650;LINESTRING(300000 4000000, 300100 4000200)&#x27;</span>) <span class="keyword">AS</span> geom;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- geometry → EWKT</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsEWKT(ST_GeomFromEWKT(<span class="string">&#x27;SRID=32650;LINESTRING(300000 4000000, 300100 4000200)&#x27;</span>)) <span class="keyword">AS</span> ewkt;</span><br><span class="line"><span class="comment">-- 输出：SRID=32650;LINESTRING(300000 4000000,300100 4000200)</span></span><br></pre></td></tr></table></figure><h4 id="2-二进制格式-↔-内部-geometry-类型">2. 二进制格式 ↔ 内部 geometry 类型</h4><h5 id="1-WKB-↔-geometry">1. WKB ↔ geometry</h5><ul><li><code>ST_GeomFromWKB(wkb, srid)</code>：从 WKB 二进制创建 geometry（需指定 SRID）。</li><li><code>ST_AsBinary(geom)</code>：将 geometry 转为 WKB 二进制。</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 先将 geometry 转为 WKB（二进制）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsBinary(ST_GeomFromText(<span class="string">&#x27;POINT(116.4 39.9)&#x27;</span>, <span class="number">4326</span>)) <span class="keyword">AS</span> wkb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- WKB → geometry（使用上面的 WKB 结果）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_GeomFromWKB(ST_AsBinary(ST_GeomFromText(<span class="string">&#x27;POINT(116.4 39.9)&#x27;</span>, <span class="number">4326</span>)), <span class="number">4326</span>) <span class="keyword">AS</span> geom;</span><br></pre></td></tr></table></figure><h5 id="2-EWKB-↔-geometry">2. EWKB ↔ geometry</h5><ul><li><code>ST_GeomFromEWKB(ewkb)</code>：从 EWKB 二进制创建 geometry（EWKB 自带 SRID）。</li><li><code>ST_AsEWKB(geom)</code>：将 geometry 转为 EWKB 二进制（PostGIS 内部存储格式）。</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- geometry → EWKB</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsEWKB(ST_GeomFromText(<span class="string">&#x27;POINT(116.4 39.9)&#x27;</span>, <span class="number">4326</span>)) <span class="keyword">AS</span> ewkb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- EWKB → geometry</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_GeomFromEWKB(ST_AsEWKB(ST_GeomFromText(<span class="string">&#x27;POINT(116.4 39.9)&#x27;</span>, <span class="number">4326</span>))) <span class="keyword">AS</span> geom;</span><br></pre></td></tr></table></figure><h4 id="3-Web-常用格式-↔-geometry-类型">3. Web 常用格式 ↔ geometry 类型</h4><h5 id="1-GeoJSON-↔-geometry">1. GeoJSON ↔ geometry</h5><ul><li><code>ST_GeomFromGeoJSON(geojson)</code>：从 GeoJSON 字符串创建 geometry（默认 SRID=4326）。</li><li><code>ST_AsGeoJSON(geom)</code>：将 geometry 转为 GeoJSON 字符串。</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- GeoJSON → geometry</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_GeomFromGeoJSON(<span class="string">&#x27;&#123;&quot;type&quot;:&quot;Point&quot;,&quot;coordinates&quot;:[116.4,39.9]&#125;&#x27;</span>) <span class="keyword">AS</span> geom;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- geometry → GeoJSON</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsGeoJSON(ST_GeomFromText(<span class="string">&#x27;POLYGON((116.3 39.8, 116.4 39.8, 116.4 39.9, 116.3 39.9, 116.3 39.8))&#x27;</span>, <span class="number">4326</span>)) <span class="keyword">AS</span> geojson;</span><br><span class="line"><span class="comment">-- 输出：&#123;&quot;type&quot;:&quot;Polygon&quot;,&quot;coordinates&quot;:[[[116.3,39.8],[116.4,39.8],[116.4,39.9],[116.3,39.9],[116.3,39.8]]]&#125;</span></span><br></pre></td></tr></table></figure><h5 id="2-KML-↔-geometry">2. KML ↔ geometry</h5><ul><li><code>ST_GeomFromKML(kml)</code>：从 KML 字符串创建 geometry（默认 SRID=4326）。</li><li><code>ST_AsKML(geom)</code>：将 geometry 转为 KML 字符串。</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- KML → geometry</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_GeomFromKML(<span class="string">&#x27;&lt;Point&gt;&lt;coordinates&gt;116.4,39.9&lt;/coordinates&gt;&lt;/Point&gt;&#x27;</span>) <span class="keyword">AS</span> geom;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- geometry → KML</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsKML(ST_GeomFromText(<span class="string">&#x27;LINESTRING(116.3 39.8, 116.4 39.9)&#x27;</span>, <span class="number">4326</span>)) <span class="keyword">AS</span> kml;</span><br><span class="line"><span class="comment">-- 输出：&lt;LineString&gt;&lt;coordinates&gt;116.3,39.8,0 116.4,39.9,0&lt;/coordinates&gt;&lt;/LineString&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-跨格式间接转换（以-geometry-为中间层）">4. 跨格式间接转换（以 geometry 为中间层）</h4><p>例如：<strong>WKT → GeoJSON</strong>、<strong>KML → EWKT</strong> 等，需先转为 geometry，再转目标格式。</p><h5 id="1-示例-1：WKT-→-GeoJSON">1. 示例 1：WKT → GeoJSON</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 步骤：WKT → geometry → GeoJSON</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsGeoJSON(</span><br><span class="line">  ST_GeomFromText(<span class="string">&#x27;POINT(116.4 39.9)&#x27;</span>, <span class="number">4326</span>)  <span class="comment">-- 先转 geometry</span></span><br><span class="line">) <span class="keyword">AS</span> wkt_to_geojson;</span><br><span class="line"><span class="comment">-- 输出：&#123;&quot;type&quot;:&quot;Point&quot;,&quot;coordinates&quot;:[116.4,39.9]&#125;</span></span><br></pre></td></tr></table></figure><h5 id="2-示例-2：KML-→-EWKT">2. 示例 2：KML → EWKT</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 步骤：KML → geometry → EWKT</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsEWKT(</span><br><span class="line">  ST_GeomFromKML(<span class="string">&#x27;&lt;LineString&gt;&lt;coordinates&gt;116.3,39.8 116.4,39.9&lt;/coordinates&gt;&lt;/LineString&gt;&#x27;</span>)  <span class="comment">-- 先转 geometry</span></span><br><span class="line">) <span class="keyword">AS</span> kml_to_ewkt;</span><br><span class="line"><span class="comment">-- 输出：SRID=4326;LINESTRING(116.3 39.8,116.4 39.9)</span></span><br></pre></td></tr></table></figure><h4 id="5-坐标系转换（SRID-变更）">5. 坐标系转换（SRID 变更）</h4><p>严格来说不属于 “格式转换”，但属于空间数据处理的常见操作（需先确保目标 SRID 已在 PostGIS 中注册）。</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 将 SRID=4326（经纬度）转为 SRID=32650（UTM 50N，米）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_Transform(</span><br><span class="line">  ST_GeomFromText(<span class="string">&#x27;POINT(116.4 39.9)&#x27;</span>, <span class="number">4326</span>),  <span class="comment">-- 原 geometry（WGS84 经纬度）</span></span><br><span class="line">  <span class="number">32650</span>  <span class="comment">-- 目标 SRID</span></span><br><span class="line">) <span class="keyword">AS</span> transformed_geom;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看转换后的 EWKT（含新 SRID）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsEWKT(ST_Transform(ST_GeomFromText(<span class="string">&#x27;POINT(116.4 39.9)&#x27;</span>, <span class="number">4326</span>), <span class="number">32650</span>)) <span class="keyword">AS</span> ewkt;</span><br><span class="line"><span class="comment">-- 输出类似：SRID=32650;POINT(300000 4000000)（具体值取决于经纬度对应的 UTM 坐标）</span></span><br></pre></td></tr></table></figure><h4 id="6-总结">6. 总结</h4><ul><li>所有格式转换均以 <code>geometry</code> 类型为中间层，核心是掌握 <code>ST_AsXXX</code>（转为目标格式）和 <code>ST_GeomFromXXX</code>（从源格式创建 geometry）系列函数。</li><li>带坐标系的格式（如 EWKT、GeoJSON 带 crs）转换时会自动保留 SRID，无坐标系的格式（如 WKT、WKB）需手动指定 SRID。</li><li>实际开发中，根据场景选择转换方向（如前端展示用 <code>ST_AsGeoJSON</code>，数据入库用 <code>ST_GeomFromEWKT</code>）。</li></ul><h3 id="空间数据的增删查改">空间数据的增删查改</h3><p>在 PostGIS 中，空间数据的增删查改（CRUD）操作与普通 PostgreSQL 数据类似，但需结合空间数据类型（<code>geometry</code>/<code>geography</code>）和相关函数。以下是具体示例：</p><h4 id="1-准备工作：创建带空间字段的表">1. 准备工作：创建带空间字段的表</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建表（指定 SRID=4326，WGS84 经纬度）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> cities (</span><br><span class="line">    id SERIAL <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name TEXT <span class="keyword">NOT NULL</span>,</span><br><span class="line">    population <span class="type">INT</span>,  <span class="comment">-- 人口</span></span><br><span class="line">    geom geometry(Point, <span class="number">4326</span>)  <span class="comment">-- 空间字段：点类型，SRID=4326</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 为空间字段创建空间索引（优化查询性能）</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_cities_geom <span class="keyword">ON</span> cities <span class="keyword">USING</span> GIST (geom);</span><br></pre></td></tr></table></figure><h4 id="2-增加（Create）空间数据">2. 增加（Create）空间数据</h4><p>插入空间数据时，需用 PostGIS 函数生成 <code>geometry</code> 对象（如 <code>ST_MakePoint</code>+<code>ST_SetSRID</code> 或 <code>ST_GeomFromText</code> 等）。</p><h5 id="1-示例：插入城市点数据">1. 示例：插入城市点数据</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 方法1：用 ST_MakePoint 生成点（经度, 纬度），并指定 SRID</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> cities (name, population, geom)</span><br><span class="line"><span class="keyword">VALUES</span> </span><br><span class="line">(<span class="string">&#x27;北京&#x27;</span>, <span class="number">21540000</span>, ST_SetSRID(ST_MakePoint(<span class="number">116.4074</span>, <span class="number">39.9042</span>), <span class="number">4326</span>)),</span><br><span class="line">(<span class="string">&#x27;上海&#x27;</span>, <span class="number">24870000</span>, ST_SetSRID(ST_MakePoint(<span class="number">121.4737</span>, <span class="number">31.2304</span>), <span class="number">4326</span>)),</span><br><span class="line">(<span class="string">&#x27;广州&#x27;</span>, <span class="number">15300000</span>, ST_SetSRID(ST_MakePoint(<span class="number">113.2644</span>, <span class="number">23.1291</span>), <span class="number">4326</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方法2：用 ST_GeomFromText 从 WKT 格式插入（需指定 SRID）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> cities (name, population, geom)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;深圳&#x27;</span>, <span class="number">13030000</span>, ST_GeomFromText(<span class="string">&#x27;POINT(114.0579 22.5431)&#x27;</span>, <span class="number">4326</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方法3：用 ST_GeomFromEWKT 从 EWKT 格式插入（自带 SRID）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> cities (name, population, geom)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;杭州&#x27;</span>, <span class="number">10360000</span>, ST_GeomFromEWKT(<span class="string">&#x27;SRID=4326;POINT(120.1551 30.2741)&#x27;</span>));</span><br></pre></td></tr></table></figure><h4 id="3-查询（Read）空间数据">3. 查询（Read）空间数据</h4><p>查询时可结合空间函数（如距离计算、范围筛选）和普通字段筛选。</p><h5 id="1-示例-1：查询所有城市的基本信息和空间坐标（WKT-格式）">1. 示例 1：查询所有城市的基本信息和空间坐标（WKT 格式）</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    id, </span><br><span class="line">    name, </span><br><span class="line">    population, </span><br><span class="line">    ST_AsText(geom) <span class="keyword">AS</span> coordinates  <span class="comment">-- 转为人类可读的 WKT 格式</span></span><br><span class="line"><span class="keyword">FROM</span> cities;</span><br></pre></td></tr></table></figure><h5 id="2-示例-2：查询距离北京-1000-公里以内的城市（用-geography-类型计算球面距离）">2. 示例 2：查询距离北京 1000 公里以内的城市（用 <code>geography</code> 类型计算球面距离）</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 先将 geometry 转为 geography 类型（支持球面距离计算）</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    c.name, </span><br><span class="line">    ST_Distance(c.geom::geography, bj.geom::geography) <span class="operator">/</span> <span class="number">1000</span> <span class="keyword">AS</span> distance_km  <span class="comment">-- 距离（公里）</span></span><br><span class="line"><span class="keyword">FROM</span> cities c, cities bj</span><br><span class="line"><span class="keyword">WHERE</span> bj.name <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span> </span><br><span class="line">  <span class="keyword">AND</span> c.name <span class="operator">!=</span> <span class="string">&#x27;北京&#x27;</span> </span><br><span class="line">  <span class="keyword">AND</span> ST_Distance(c.geom::geography, bj.geom::geography) <span class="operator">&lt;</span> <span class="number">1000000</span>;  <span class="comment">-- 1000000 米 = 1000 公里</span></span><br></pre></td></tr></table></figure><h5 id="3-示例-3：查询某矩形范围内的城市（如经度-110°-120°，纬度-20°-35°）">3. 示例 3：查询某矩形范围内的城市（如经度 110°~120°，纬度 20°~35°）</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 用 ST_MakeEnvelope 创建矩形范围（minx, miny, maxx, maxy, srid）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, ST_AsText(geom) <span class="keyword">AS</span> coordinates</span><br><span class="line"><span class="keyword">FROM</span> cities</span><br><span class="line"><span class="keyword">WHERE</span> ST_Intersects(</span><br><span class="line">    geom, </span><br><span class="line">    ST_MakeEnvelope(<span class="number">110</span>, <span class="number">20</span>, <span class="number">120</span>, <span class="number">35</span>, <span class="number">4326</span>)  <span class="comment">-- 矩形范围</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 结果：广州、深圳（北京、上海、杭州不在此范围内）</span></span><br></pre></td></tr></table></figure><h4 id="4-更新（Update）空间数据">4. 更新（Update）空间数据</h4><p>可更新空间字段的坐标或普通字段，结合空间函数修改几何形状。</p><h5 id="1-示例-1：修改城市的坐标（如调整深圳的经纬度）">1. 示例 1：修改城市的坐标（如调整深圳的经纬度）</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> cities</span><br><span class="line"><span class="keyword">SET</span> geom <span class="operator">=</span> ST_SetSRID(ST_MakePoint(<span class="number">114.0665</span>, <span class="number">22.5461</span>), <span class="number">4326</span>)  <span class="comment">-- 新坐标</span></span><br><span class="line"><span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;深圳&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="2-示例-2：批量更新坐标系（如从-SRID-4326-转为-UTM-50N-的-SRID-32650）">2. 示例 2：批量更新坐标系（如从 SRID=4326 转为 UTM 50N 的 SRID=32650）</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 先添加一个新的 geometry 字段存储 UTM 坐标</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> cities <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> geom_utm geometry(Point, <span class="number">32650</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用 ST_Transform 转换坐标系并更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> cities</span><br><span class="line"><span class="keyword">SET</span> geom_utm <span class="operator">=</span> ST_Transform(geom, <span class="number">32650</span>);  <span class="comment">-- 从 4326 转为 32650</span></span><br></pre></td></tr></table></figure><h4 id="5-删除（Delete）空间数据">5. 删除（Delete）空间数据</h4><h5 id="1-示例-1：删除指定城市">1. 示例 1：删除指定城市</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> cities</span><br><span class="line"><span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;杭州&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="2-示例-2：删除人口少于-1000-万的城市">2. 示例 2：删除人口少于 1000 万的城市</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> cities</span><br><span class="line"><span class="keyword">WHERE</span> population <span class="operator">&lt;</span> <span class="number">10000000</span>;</span><br><span class="line"><span class="comment">-- 结果：删除人口小于 1000 万的城市（假设示例中只有杭州被删除，其他均超过）</span></span><br></pre></td></tr></table></figure><h4 id="6-总结-2">6. 总结</h4><ul><li><strong>增加</strong>：用 <code>ST_MakePoint</code>、<code>ST_GeomFromText</code> 等函数生成 <code>geometry</code> 对象插入。</li><li><strong>查询</strong>：结合 <code>ST_AsText</code>（转换格式）、<code>ST_Distance</code>（距离）、<code>ST_Intersects</code>（范围）等空间函数。</li><li><strong>更新</strong>：通过空间函数修改 <code>geometry</code> 字段的值，或用 <code>ST_Transform</code> 转换坐标系。</li><li><strong>删除</strong>：与普通 SQL 一致，按条件删除记录。</li></ul><p>核心是利用 PostGIS 函数处理空间数据的特殊性，同时为空间字段创建 <code>GIST</code> 索引以提升查询效率。</p><h3 id="常用基础空间查询函数的使用">常用基础空间查询函数的使用</h3><p>PostGIS 提供了丰富的空间查询函数，用于处理几何对象的关系、测量、转换等操作。以下是最常用的基础空间查询函数及其使用示例，基于 <code>geometry</code> 或 <code>geography</code> 类型：</p><h4 id="一-几何关系查询函数">一. 几何关系查询函数</h4><p>用于判断两个几何对象之间的空间关系（如包含、相交、相邻等），遵循 OGC 简单要素规范。</p><h5 id="1-ST-Contains-geomA-geomB">1. ST_Contains(geomA, geomB)</h5><p>判断 <code>geomA</code> 是否完全包含 <code>geomB</code>（<code>geomB</code> 的所有点都在 <code>geomA</code> 内）。</p><p><strong>示例</strong>：查询 “广东省” 多边形完全包含的城市点</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 假设有 provinces 表（多边形）和 cities 表（点），均为 SRID=4326</span></span><br><span class="line"><span class="keyword">SELECT</span> c.name </span><br><span class="line"><span class="keyword">FROM</span> cities c, provinces p</span><br><span class="line"><span class="keyword">WHERE</span> p.name <span class="operator">=</span> <span class="string">&#x27;广东省&#x27;</span> </span><br><span class="line">  <span class="keyword">AND</span> ST_Contains(p.geom, c.geom);</span><br></pre></td></tr></table></figure><h5 id="2-ST-Intersects-geomA-geomB">2. ST_Intersects(geomA, geomB)</h5><p>判断 <code>geomA</code> 和 <code>geomB</code> 是否存在交集（至少有一个共同点）。</p><p><strong>示例</strong>：查询与 “珠江” 线串相交的城市</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c.name </span><br><span class="line"><span class="keyword">FROM</span> cities c, rivers r</span><br><span class="line"><span class="keyword">WHERE</span> r.name <span class="operator">=</span> <span class="string">&#x27;珠江&#x27;</span> </span><br><span class="line">  <span class="keyword">AND</span> ST_Intersects(c.geom, r.geom);</span><br></pre></td></tr></table></figure><h5 id="3-ST-DWithin-geomA-geomB-distance">3. ST_DWithin(geomA, geomB, distance)</h5><p>判断 <code>geomA</code> 和 <code>geomB</code> 之间的最短距离是否小于等于 <code>distance</code>（单位取决于 SRID：<code>geometry</code> 用坐标单位，<code>geography</code> 用米）。</p><p><strong>示例</strong>：查询距离 “上海” 100 公里以内的城市（用 <code>geography</code> 类型计算球面距离）</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c.name, </span><br><span class="line">       ST_Distance(c.geom::geography, sh.geom::geography)<span class="operator">/</span><span class="number">1000</span> <span class="keyword">AS</span> distance_km</span><br><span class="line"><span class="keyword">FROM</span> cities c, cities sh</span><br><span class="line"><span class="keyword">WHERE</span> sh.name <span class="operator">=</span> <span class="string">&#x27;上海&#x27;</span> </span><br><span class="line">  <span class="keyword">AND</span> c.name <span class="operator">!=</span> <span class="string">&#x27;上海&#x27;</span> </span><br><span class="line">  <span class="keyword">AND</span> ST_DWithin(c.geom::geography, sh.geom::geography, <span class="number">100000</span>);  <span class="comment">-- 100000米=100公里</span></span><br></pre></td></tr></table></figure><h5 id="4-ST-Touches-geomA-geomB">4. ST_Touches(geomA, geomB)</h5><p>判断 <code>geomA</code> 和 <code>geomB</code> 是否边界相交，但内部不重叠（如相邻的两个多边形共享一条边）。</p><p><strong>示例</strong>：查询与 “北京市” 多边形边界相邻的城市</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c.name </span><br><span class="line"><span class="keyword">FROM</span> cities c, provinces p</span><br><span class="line"><span class="keyword">WHERE</span> p.name <span class="operator">=</span> <span class="string">&#x27;北京市&#x27;</span> </span><br><span class="line">  <span class="keyword">AND</span> ST_Touches(p.geom, c.geom);</span><br></pre></td></tr></table></figure><h4 id="二、-测量计算函数">二、 测量计算函数</h4><p>用于计算几何对象的距离、长度、面积等。</p><h5 id="1-ST-Distance-geomA-geomB">1. ST_Distance(geomA, geomB)</h5><p>计算 <code>geomA</code> 和 <code>geomB</code> 之间的最短距离（<code>geometry</code> 返回平面距离，<code>geography</code> 返回球面距离）。</p><p><strong>示例</strong>：计算北京到上海的球面距离（公里）</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ST_Distance(bj.geom::geography, sh.geom::geography)<span class="operator">/</span><span class="number">1000</span> <span class="keyword">AS</span> distance_km</span><br><span class="line"><span class="keyword">FROM</span> cities bj, cities sh</span><br><span class="line"><span class="keyword">WHERE</span> bj.name <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span> <span class="keyword">AND</span> sh.name <span class="operator">=</span> <span class="string">&#x27;上海&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="2-ST-Length-geom">2. ST_Length(geom)</h5><p>计算线串（<code>LineString</code>）或多线串（<code>MultiLineString</code>）的长度（单位同 <code>ST_Distance</code>）。</p><p><strong>示例</strong>：计算 “长江” 的总长度（公里）</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ST_Length(r.geom::geography)<span class="operator">/</span><span class="number">1000</span> <span class="keyword">AS</span> length_km</span><br><span class="line"><span class="keyword">FROM</span> rivers r</span><br><span class="line"><span class="keyword">WHERE</span> r.name <span class="operator">=</span> <span class="string">&#x27;长江&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="3-ST-Area-geom">3. ST_Area(geom)</h5><p>计算多边形（<code>Polygon</code>）或多多边形（<code>MultiPolygon</code>）的面积（<code>geometry</code> 返回平面面积，<code>geography</code> 返回球面面积）。</p><p><strong>示例</strong>：计算 “青海省” 的面积（平方公里）</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ST_Area(p.geom::geography)<span class="operator">/</span><span class="number">1000000</span> <span class="keyword">AS</span> area_km2  <span class="comment">-- 1平方公里=1e6平方米</span></span><br><span class="line"><span class="keyword">FROM</span> provinces p</span><br><span class="line"><span class="keyword">WHERE</span> p.name <span class="operator">=</span> <span class="string">&#x27;青海省&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="4-ST-Perimeter-geom">4. ST_Perimeter(geom)</h5><p>计算多边形的周长（单位同长度）。</p><p><strong>示例</strong>：计算 “海南岛” 多边形的周长（公里）</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ST_Perimeter(i.geom::geography)<span class="operator">/</span><span class="number">1000</span> <span class="keyword">AS</span> perimeter_km</span><br><span class="line"><span class="keyword">FROM</span> islands i</span><br><span class="line"><span class="keyword">WHERE</span> i.name <span class="operator">=</span> <span class="string">&#x27;海南岛&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="三、几何转换与提取函数">三、几何转换与提取函数</h4><p>用于转换几何类型或提取几何对象的部分信息。</p><h5 id="1-ST-AsText-geom-ST-AsGeoJSON-geom">1. ST_AsText(geom)<code>/</code>ST_AsGeoJSON(geom)</h5><p>将 <code>geometry</code> 转为人类可读的文本格式（WKT 或 GeoJSON）。</p><p><strong>示例</strong>：查询城市坐标的 WKT 和 GeoJSON 格式</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  name,</span><br><span class="line">  ST_AsText(geom) <span class="keyword">AS</span> wkt_coords,</span><br><span class="line">  ST_AsGeoJSON(geom) <span class="keyword">AS</span> geojson_coords</span><br><span class="line"><span class="keyword">FROM</span> cities</span><br><span class="line"><span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="2-ST-Centroid-geom">2. ST_Centroid(geom)</h5><p>计算多边形或线串的几何中心（质心）。</p><p><strong>示例</strong>：计算 “浙江省” 的省会（质心点）</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  p.name,</span><br><span class="line">  ST_AsText(ST_Centroid(p.geom)) <span class="keyword">AS</span> centroid</span><br><span class="line"><span class="keyword">FROM</span> provinces p</span><br><span class="line"><span class="keyword">WHERE</span> p.name <span class="operator">=</span> <span class="string">&#x27;浙江省&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="3-ST-Transform-geom-target-srid">3. ST_Transform(geom, target_srid)</h5><p>将几何对象从当前 SRID 转换为目标 SRID（需确保目标 SRID 已注册）。</p><p><strong>示例</strong>：将北京的 WGS84 经纬度（SRID=4326）转为 UTM 50N（SRID=32650）坐标</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  ST_AsText(geom) <span class="keyword">AS</span> wgs84_coords,</span><br><span class="line">  ST_AsText(ST_Transform(geom, <span class="number">32650</span>)) <span class="keyword">AS</span> utm50n_coords</span><br><span class="line"><span class="keyword">FROM</span> cities</span><br><span class="line"><span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="4-ST-Buffer-geom-distance">4. ST_Buffer(geom, distance)</h5><p>以 <code>geom</code> 为中心，生成指定距离的缓冲区（单位同 <code>ST_Distance</code>）。</p><p><strong>示例</strong>：生成以上海为中心、半径 50 公里的缓冲区（用于范围筛选）</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建上海 50 公里缓冲区，并查询缓冲区内的城市</span></span><br><span class="line"><span class="keyword">SELECT</span> c.name</span><br><span class="line"><span class="keyword">FROM</span> cities c, cities sh</span><br><span class="line"><span class="keyword">WHERE</span> sh.name <span class="operator">=</span> <span class="string">&#x27;上海&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> ST_Intersects(c.geom, ST_Buffer(sh.geom::geography, <span class="number">50000</span>)::geometry);</span><br></pre></td></tr></table></figure><h4 id="四、几何属性查询函数">四、几何属性查询函数</h4><p>用于获取几何对象的基本属性。</p><h5 id="1-ST-GeometryType-geom">1. ST_GeometryType(geom)</h5><p>返回几何对象的具体类型（如 <code>POINT</code>、<code>POLYGON</code>）。</p><p><strong>示例</strong>：查询表中所有几何类型</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> ST_GeometryType(geom) <span class="keyword">AS</span> geom_type <span class="keyword">FROM</span> spatial_table;</span><br></pre></td></tr></table></figure><h5 id="2-ST-SRID-geom">2. ST_SRID(geom)</h5><p>返回几何对象的 SRID（空间参考标识符）。</p><p><strong>示例</strong>：检查城市表的 SRID 是否为 4326</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, ST_SRID(geom) <span class="keyword">AS</span> srid <span class="keyword">FROM</span> cities;</span><br></pre></td></tr></table></figure><h5 id="3-ST-NPoints-geom">3. ST_NPoints(geom)</h5><p>返回线串或多边形的顶点数量。</p><p><strong>示例</strong>：查询某条道路线串的顶点数</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> r.name, ST_NPoints(r.geom) <span class="keyword">AS</span> point_count</span><br><span class="line"><span class="keyword">FROM</span> roads r</span><br><span class="line"><span class="keyword">WHERE</span> r.name <span class="operator">=</span> <span class="string">&#x27;长安街&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="五、总结">五、总结</h4><ul><li><strong>关系查询</strong>：<code>ST_Contains</code>、<code>ST_Intersects</code>、<code>ST_DWithin</code> 是判断空间关系的核心函数，常用于筛选符合条件的对象。</li><li><strong>测量计算</strong>：<code>ST_Distance</code>、<code>ST_Length</code>、<code>ST_Area</code> 用于量化几何属性，注意 <code>geometry</code> 和 <code>geography</code> 类型的单位差异。</li><li><strong>转换提取</strong>：<code>ST_Transform</code> 用于坐标系转换，<code>ST_AsText</code>/<code>ST_AsGeoJSON</code> 用于格式转换，<code>ST_Buffer</code> 用于范围扩展。</li><li><strong>属性查询</strong>：<code>ST_GeometryType</code>、<code>ST_SRID</code> 用于验证几何对象的基本信息。</li></ul><p>使用时需根据数据的 SRID 类型（平面 / 球面）选择合适的函数，并结合空间索引（<code>GIST</code>）提升查询效率。</p><h3 id="常用分析函数的使用">常用分析函数的使用</h3><p>PostGIS 提供了一系列用于空间分析的函数，可用于解决缓冲区分析、叠加分析、网络分析、密度分析等常见空间问题。以下是常用分析函数的分类及使用示例：</p><h4 id="一、缓冲区分析（Buffer-Analysis）">一、缓冲区分析（Buffer Analysis）</h4><p>通过 <code>ST_Buffer</code> 生成几何对象的缓冲区，用于范围筛选、影响区域分析等。</p><h5 id="1-函数：ST-Buffer-geom-distance">1. 函数：ST_Buffer(geom, distance)</h5><ul><li>功能：以 <code>geom</code> 为中心，生成半径为 <code>distance</code> 的缓冲区（<code>geometry</code> 类型用坐标单位，<code>geography</code> 类型用米）。</li><li>示例：分析某地铁站 500 米范围内的公交站（假设坐标单位为米，SRID=32650）</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 地铁站表（points）和公交站表（bus_stops）</span></span><br><span class="line"><span class="keyword">SELECT</span> bs.name <span class="keyword">AS</span> bus_stop_name</span><br><span class="line"><span class="keyword">FROM</span> subway_stations ss, bus_stops bs</span><br><span class="line"><span class="keyword">WHERE</span> ss.name <span class="operator">=</span> <span class="string">&#x27;人民广场站&#x27;</span></span><br><span class="line">  <span class="comment">-- 地铁站的 500 米缓冲区与公交站相交</span></span><br><span class="line">  <span class="keyword">AND</span> ST_Intersects(ST_Buffer(ss.geom, <span class="number">500</span>), bs.geom);</span><br></pre></td></tr></table></figure><h4 id="二、叠加分析">二、叠加分析</h4><p>对多个几何对象进行叠加计算，生成新的几何或属性（如交集、并集、差异等）。</p><h5 id="1-ST-Intersection-geomA-geomB">1. ST_Intersection(geomA, geomB)</h5><ul><li>功能：返回 <code>geomA</code> 和 <code>geomB</code> 的交集（重叠部分的几何）。</li><li>示例：计算 “上海市” 与 “长江” 的重叠区域（河流穿过城市的部分）</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  ST_AsText(ST_Intersection(c.geom, r.geom)) <span class="keyword">AS</span> overlap_geom</span><br><span class="line"><span class="keyword">FROM</span> cities c, rivers r</span><br><span class="line"><span class="keyword">WHERE</span> c.name <span class="operator">=</span> <span class="string">&#x27;上海市&#x27;</span> <span class="keyword">AND</span> r.name <span class="operator">=</span> <span class="string">&#x27;长江&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="2-ST-Union-geomA-geomB">2. ST_Union(geomA, geomB)</h5><ul><li>功能：返回 <code>geomA</code> 和 <code>geomB</code> 的并集（合并后的几何）。</li><li>示例：合并 “东城区” 和 “西城区” 的多边形为一个整体</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  ST_AsText(ST_Union(dongcheng.geom, xicheng.geom)) <span class="keyword">AS</span> merged_district</span><br><span class="line"><span class="keyword">FROM</span> districts dongcheng, districts xicheng</span><br><span class="line"><span class="keyword">WHERE</span> dongcheng.name <span class="operator">=</span> <span class="string">&#x27;东城区&#x27;</span> <span class="keyword">AND</span> xicheng.name <span class="operator">=</span> <span class="string">&#x27;西城区&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="3-ST-Difference-geomA-geomB">3. ST_Difference(geomA, geomB)</h5><ul><li>功能：返回 <code>geomA</code> 中减去与 <code>geomB</code> 重叠的部分（A 独有的区域）。</li><li>示例：计算 “北京市” 除去 “密云水库” 后的区域</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  ST_Area(ST_Difference(c.geom, r.geom))<span class="operator">/</span><span class="number">1000000</span> <span class="keyword">AS</span> area_km2  <span class="comment">-- 剩余面积（平方公里）</span></span><br><span class="line"><span class="keyword">FROM</span> cities c, reservoirs r</span><br><span class="line"><span class="keyword">WHERE</span> c.name <span class="operator">=</span> <span class="string">&#x27;北京市&#x27;</span> <span class="keyword">AND</span> r.name <span class="operator">=</span> <span class="string">&#x27;密云水库&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="三、最近邻分析（Nearest-Neighbor）">三、最近邻分析（Nearest Neighbor）</h4><p>查找距离目标对象最近的几何，常用于 <code>“最近设施”</code> 查询。</p><h5 id="1-函数组合：ST-Distance-排序">1. 函数组合：<code>ST_Distance</code> + 排序</h5><ul><li>示例：查找距离 “天安门” 最近的 3 个地铁站</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  ss.name <span class="keyword">AS</span> subway_name,</span><br><span class="line">  ST_Distance(tm.geom::geography, ss.geom::geography)<span class="operator">/</span><span class="number">1000</span> <span class="keyword">AS</span> distance_km  <span class="comment">-- 球面距离（公里）</span></span><br><span class="line"><span class="keyword">FROM</span> subway_stations ss, landmarks tm</span><br><span class="line"><span class="keyword">WHERE</span> tm.name <span class="operator">=</span> <span class="string">&#x27;天安门&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> distance_km</span><br><span class="line">LIMIT <span class="number">3</span>;  <span class="comment">-- 取最近的3个</span></span><br></pre></td></tr></table></figure><p><strong>优化：<code>ST_DWithin</code> 先过滤范围（减少计算量）</strong></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  ss.name, </span><br><span class="line">  ST_Distance(tm.geom::geography, ss.geom::geography)<span class="operator">/</span><span class="number">1000</span> <span class="keyword">AS</span> distance_km</span><br><span class="line"><span class="keyword">FROM</span> subway_stations ss, landmarks tm</span><br><span class="line"><span class="keyword">WHERE</span> tm.name <span class="operator">=</span> <span class="string">&#x27;天安门&#x27;</span></span><br><span class="line">  <span class="comment">-- 先筛选1公里内的候选，再排序（效率更高）</span></span><br><span class="line">  <span class="keyword">AND</span> ST_DWithin(tm.geom::geography, ss.geom::geography, <span class="number">1000</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> distance_km</span><br><span class="line">LIMIT <span class="number">3</span>;</span><br></pre></td></tr></table></figure><h4 id="四、密度分析（Density-Analysis）">四、密度分析（Density Analysis）</h4><p>通过 <code>ST_HexGrid</code> 或 <code>ST_Count</code> 等函数分析要素在空间上的分布密度（如人口密度、设施密度）。</p><h5 id="1-生成网格并统计密度">1. 生成网格并统计密度</h5><p>示例：在上海市范围内生成 1km×1km 的六边形网格，统计每个网格内的便利店数量</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 生成覆盖上海市的 1km 六边形网格（SRID=32650，单位米）</span></span><br><span class="line"><span class="keyword">WITH</span> hex_grid <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> hex.geom <span class="keyword">AS</span> hex_geom</span><br><span class="line">  <span class="keyword">FROM</span> ST_HexGrid(<span class="number">1000</span>, ST_Transform(sh.geom, <span class="number">32650</span>)) <span class="keyword">AS</span> hex  <span class="comment">-- 1000米网格，基于上海范围</span></span><br><span class="line">  <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> cities sh</span><br><span class="line">  <span class="keyword">WHERE</span> sh.name <span class="operator">=</span> <span class="string">&#x27;上海市&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> ST_Intersects(hex.geom, ST_Transform(sh.geom, <span class="number">32650</span>))</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 统计每个网格内的便利店数量</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  ST_AsText(h.hex_geom) <span class="keyword">AS</span> hexagon,</span><br><span class="line">  <span class="built_in">COUNT</span>(c.id) <span class="keyword">AS</span> convenience_count</span><br><span class="line"><span class="keyword">FROM</span> hex_grid h</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> convenience_stores c </span><br><span class="line">  <span class="keyword">ON</span> ST_Intersects(h.hex_geom, ST_Transform(c.geom, <span class="number">32650</span>))  <span class="comment">-- 转换便利店坐标到网格SRID</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> h.hex_geom;</span><br></pre></td></tr></table></figure><h5 id="2-核密度估计（需-PostGIS-3-0-）">2. 核密度估计（需 PostGIS 3.0+）</h5><p>函数：<code>ST_KDE</code>（基于点要素生成连续密度表面）</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 计算上海市范围内的人口核密度（假设人口点数据在 population_points 表）</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsRaster(</span><br><span class="line">  ST_KDE(pp.geom, bandwidth :<span class="operator">=</span> <span class="number">5000</span>),  <span class="comment">-- 带宽5000米（影响范围）</span></span><br><span class="line">  <span class="number">100</span>, <span class="number">100</span>  <span class="comment">-- 输出 raster 分辨率（100×100像素）</span></span><br><span class="line">) <span class="keyword">AS</span> population_density_raster</span><br><span class="line"><span class="keyword">FROM</span> population_points pp, cities sh</span><br><span class="line"><span class="keyword">WHERE</span> ST_Intersects(pp.geom, sh.geom) <span class="keyword">AND</span> sh.name <span class="operator">=</span> <span class="string">&#x27;上海市&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="五、网络分析（Network-Analysis）">五、网络分析（Network Analysis）</h4><p>基于线串网络（如道路、管线）的分析，需结合 <code>pgrouting</code> 扩展，PostGIS 基础函数可辅助预处理。</p><h5 id="1-线串拆分与节点提取">1. 线串拆分与节点提取</h5><ul><li>函数：<code>ST_Split</code>（拆分线串）、<code>ST_Nodes</code>（提取线串所有节点）</li><li>示例：将 “主干道” 线串按交叉点拆分为路段</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 提取所有道路的交叉点</span></span><br><span class="line"><span class="keyword">WITH</span> road_nodes <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> ST_Nodes(r.geom) <span class="keyword">AS</span> node_geom</span><br><span class="line">  <span class="keyword">FROM</span> roads r</span><br><span class="line">  <span class="keyword">WHERE</span> r.type <span class="operator">=</span> <span class="string">&#x27;主干道&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 按交叉点拆分主干道为路段</span></span><br><span class="line"><span class="keyword">SELECT</span> ST_AsText(ST_Split(r.geom, ST_Collect(n.node_geom))) <span class="keyword">AS</span> split_segments</span><br><span class="line"><span class="keyword">FROM</span> roads r, road_nodes n</span><br><span class="line"><span class="keyword">WHERE</span> r.type <span class="operator">=</span> <span class="string">&#x27;主干道&#x27;</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> r.geom;</span><br></pre></td></tr></table></figure><h5 id="2-最短路径">2. 最短路径</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 需先安装 pgrouting 扩展，创建网络拓扑</span></span><br><span class="line"><span class="comment">-- 示例：从 A 点到 B 点的最短路径（基于道路长度）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> pgr_dijkstra(</span><br><span class="line">  <span class="string">&#x27;SELECT id, source, target, length AS cost FROM roads&#x27;</span>,  <span class="comment">-- 道路网络（带长度成本）</span></span><br><span class="line">  (<span class="keyword">SELECT</span> source <span class="keyword">FROM</span> roads_vertices_pgr <span class="keyword">WHERE</span> ST_DWithin(geom, ST_SetSRID(ST_MakePoint(<span class="number">116.4</span>, <span class="number">39.9</span>), <span class="number">4326</span>), <span class="number">100</span>)),  <span class="comment">-- 起点最近节点</span></span><br><span class="line">  (<span class="keyword">SELECT</span> target <span class="keyword">FROM</span> roads_vertices_pgr <span class="keyword">WHERE</span> ST_DWithin(geom, ST_SetSRID(ST_MakePoint(<span class="number">116.5</span>, <span class="number">39.9</span>), <span class="number">4326</span>), <span class="number">100</span>)),  <span class="comment">-- 终点最近节点</span></span><br><span class="line">  directed :<span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="六、空间聚合分析">六、空间聚合分析</h4><p>对空间数据按几何范围或属性进行聚合（如按行政区统计数量、平均值）。</p><p>函数：<code>ST_Collect</code>（聚合几何）、<code>ST_Union</code>（合并几何）结合 <code>GROUP BY</code></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  p.name <span class="keyword">AS</span> province,</span><br><span class="line">  <span class="built_in">COUNT</span>(c.id) <span class="keyword">AS</span> city_count,  <span class="comment">-- 城市数量</span></span><br><span class="line">  <span class="built_in">AVG</span>(c.population) <span class="keyword">AS</span> avg_population,  <span class="comment">-- 平均人口</span></span><br><span class="line">  ST_Union(c.geom) <span class="keyword">AS</span> city_points  <span class="comment">-- 聚合所有城市点为多点几何</span></span><br><span class="line"><span class="keyword">FROM</span> provinces p</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> cities c <span class="keyword">ON</span> ST_Contains(p.geom, c.geom)  <span class="comment">-- 城市在省份内</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> p.name;</span><br></pre></td></tr></table></figure><h4 id="七、总结">七、总结</h4><ul><li><strong>缓冲区分析</strong>：<code>ST_Buffer</code> 是核心，用于范围影响评估。</li><li><strong>叠加分析</strong>：<code>ST_Intersection</code>、<code>ST_Union</code>、<code>ST_Difference</code> 处理多几何间的空间关系。</li><li><strong>最近邻分析</strong>：通过 <code>ST_Distance</code> 排序或 <code>ST_DWithin</code> 筛选，高效查找最近要素。</li><li><strong>密度分析</strong>：<code>ST_HexGrid</code> 生成网格统计密度，<code>ST_KDE</code> 生成连续密度表面。</li><li><strong>网络分析</strong>：基础函数辅助预处理，结合 <code>pgrouting</code> 实现路径计算。</li><li><strong>聚合分析</strong>：结合 <code>GROUP BY</code> 和几何聚合函数，实现空间维度的统计分析。</li></ul><p>实际应用中，需根据数据类型（<code>geometry</code>/<code>geography</code>）和场景选择函数，并注意坐标系单位对计算结果的影响（如米 vs 度）。</p><h2 id="10月10日-第二天">10月10日 第二天</h2><p>晓磊哥帮忙部署了代码，目前主要是熟悉一下公司项目代码</p></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://bu.dusays.com/2025/03/01/67c2609b7c10b.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://bu.dusays.com/2025/03/01/67c2609b7c10b.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">李阳</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.baskly.fun/posts/65070/">原创</a><a class="post-copyright-title"><span onclick='rm.copyPageUrl("https://blog.baskly.fun/posts/65070/")'>实习日志</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.baskly.fun/posts/65070/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=实习日志&amp;url=https://blog.baskly.fun/posts/65070/&amp;pic=https://bu.dusays.com/2024/11/24/674340e1191e4.png?_r_=4df18ead-b896-9763-5b8b-8b2b8754a0cf" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.baskly.fun" target="_blank">李阳的秘密小屋</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E5%AE%9E%E4%B9%A0/"><span class="categoryes-punctuation"><i class="anzhiyufont anzhiyu-icon-inbox"></i></span> 实习<span class="categoryesPageCount">3</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%AE%9E%E4%B9%A0/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span> 实习<span class="tagsPageCount">3</span></a></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2024/11/24/674340e56737a.png?_r_=ed1770ed-590c-2382-be9f-039dfc8226f1" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/23309/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://bu.dusays.com/2024/11/24/674340e362114.png?_r_=6156a4bd-adf2-b3aa-924b-973468f85222" onerror='onerror=null,src="https://bu.dusays.com/2025/05/30/68398ca86a127.gif"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">PostgreSQL教程</div></div></a></div><div class="next-post pull-right"><a href="/posts/12184/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://bu.dusays.com/2024/11/24/674340e56737a.png?_r_=ed1770ed-590c-2382-be9f-039dfc8226f1" onerror='onerror=null,src="https://bu.dusays.com/2025/05/30/68398ca86a127.gif"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">实习学习笔记</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i> <span>评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://bu.dusays.com/2025/03/01/67c2609b7c10b.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"><div class="author-status"><img class="g-status" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://bu.dusays.com/2021/01/15/805daa7195f2c.gif" alt="status"></div></div><div class="author-info__description"><div style="line-height:1.38;margin:.6rem 0;text-align:justify;color:rgba(255,255,255,.8)">这有描绘<b style="color:#fff">我的痕迹</b></div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">李阳</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/lyay23" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">10月9日 第一天</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%94%B6%E8%8E%B7"><span class="toc-number">1.1.</span> <span class="toc-text">工作收获</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E5%87%BD%E6%95%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">1.1.1.</span> <span class="toc-text">空间函数的数据类型有哪些</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E5%87%A0%E4%BD%95%E7%B1%BB%E5%9E%8B%EF%BC%88Geometry%EF%BC%89"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">1. 基本几何类型（Geometry）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9C%B0%E7%90%86%E7%B1%BB%E5%9E%8B%EF%BC%88Geography%EF%BC%89"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">2. 地理类型（Geography）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%B8%89%E7%BB%B4%E4%B8%8E%E6%B5%8B%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">3. 三维与测量类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%85%B6%E4%BB%96%E8%BE%85%E5%8A%A9%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">4. 其他辅助类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%80%BB%E7%BB%93"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">5. 总结</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E4%BD%BF%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="toc-number">1.1.1.6.</span> <span class="toc-text">6. 使用举例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E5%87%A0%E4%BD%95%E7%B1%BB%E5%9E%8B%EF%BC%88geometry%EF%BC%89"><span class="toc-number">1.1.1.6.1.</span> <span class="toc-text">1. 基本几何类型（geometry）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%9C%B0%E7%90%86%E7%B1%BB%E5%9E%8B%EF%BC%88geography%EF%BC%89"><span class="toc-number">1.1.1.6.2.</span> <span class="toc-text">2. 地理类型（geography）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E4%B8%89%E7%BB%B4%E4%B8%8E%E6%B5%8B%E9%87%8F%E7%B1%BB%E5%9E%8B%EF%BC%88Z-M-%E5%9D%90%E6%A0%87%EF%BC%89"><span class="toc-number">1.1.1.6.3.</span> <span class="toc-text">3. 三维与测量类型（Z&#x2F;M 坐标）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E8%BE%B9%E7%95%8C%E6%A1%86%E7%B1%BB%E5%9E%8B%EF%BC%88BOX2D-BOX3D%EF%BC%89"><span class="toc-number">1.1.1.6.4.</span> <span class="toc-text">4. 边界框类型（BOX2D&#x2F;BOX3D）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">1.1.2.</span> <span class="toc-text">空间数据格式有哪些</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F%EF%BC%88%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E9%83%A8%E5%AD%98%E5%82%A8%EF%BC%89"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">1. 存储格式（数据库内部存储）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%BA%8F%E5%88%97%E5%8C%96%E6%A0%BC%E5%BC%8F%EF%BC%88%E8%BE%93%E5%85%A5-%E8%BE%93%E5%87%BA-%E4%BA%A4%E6%8D%A2%E6%A0%BC%E5%BC%8F%EF%BC%89"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">2. 序列化格式（输入 &#x2F; 输出 &#x2F; 交换格式）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%80%BB%E7%BB%93"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">3. 总结</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%B8%BE%E4%BE%8B%E5%AD%90"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">4. 举例子</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-WKT%EF%BC%88Well-Known-Text%EF%BC%89%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.1.2.4.1.</span> <span class="toc-text">1. WKT（Well-Known Text）格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-EWKT%EF%BC%88Extended-WKT%EF%BC%89%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.1.2.4.2.</span> <span class="toc-text">2. EWKT（Extended WKT）格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-WKB-EWKB%EF%BC%88%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%A0%BC%E5%BC%8F%EF%BC%89"><span class="toc-number">1.1.2.4.3.</span> <span class="toc-text">3. WKB&#x2F;EWKB（二进制格式）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-GeoJSON-%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.1.2.4.4.</span> <span class="toc-text">4. GeoJSON 格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-KML%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.1.2.4.5.</span> <span class="toc-text">5. KML格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-Shapefile-%E6%A0%BC%E5%BC%8F%EF%BC%88%E5%AF%BC%E5%85%A5-%E5%AF%BC%E5%87%BA%EF%BC%89"><span class="toc-number">1.1.2.4.6.</span> <span class="toc-text">6. Shapefile 格式（导入 &#x2F; 导出）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E6%A0%BC%E5%BC%8F%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.1.3.</span> <span class="toc-text">不同格式之间的转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%96%87%E6%9C%AC%E6%A0%BC%E5%BC%8F-%E2%86%94-%E5%86%85%E9%83%A8-geometry-%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">1. 文本格式 ↔ 内部 geometry 类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-WKT-%E2%86%94-geometry"><span class="toc-number">1.1.3.1.1.</span> <span class="toc-text">1. WKT ↔ geometry</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-EWKT-%E2%86%94-geometry"><span class="toc-number">1.1.3.1.2.</span> <span class="toc-text">2. EWKT ↔ geometry</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%A0%BC%E5%BC%8F-%E2%86%94-%E5%86%85%E9%83%A8-geometry-%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">2. 二进制格式 ↔ 内部 geometry 类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-WKB-%E2%86%94-geometry"><span class="toc-number">1.1.3.2.1.</span> <span class="toc-text">1. WKB ↔ geometry</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-EWKB-%E2%86%94-geometry"><span class="toc-number">1.1.3.2.2.</span> <span class="toc-text">2. EWKB ↔ geometry</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Web-%E5%B8%B8%E7%94%A8%E6%A0%BC%E5%BC%8F-%E2%86%94-geometry-%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">3. Web 常用格式 ↔ geometry 类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-GeoJSON-%E2%86%94-geometry"><span class="toc-number">1.1.3.3.1.</span> <span class="toc-text">1. GeoJSON ↔ geometry</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-KML-%E2%86%94-geometry"><span class="toc-number">1.1.3.3.2.</span> <span class="toc-text">2. KML ↔ geometry</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%B7%A8%E6%A0%BC%E5%BC%8F%E9%97%B4%E6%8E%A5%E8%BD%AC%E6%8D%A2%EF%BC%88%E4%BB%A5-geometry-%E4%B8%BA%E4%B8%AD%E9%97%B4%E5%B1%82%EF%BC%89"><span class="toc-number">1.1.3.4.</span> <span class="toc-text">4. 跨格式间接转换（以 geometry 为中间层）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%A4%BA%E4%BE%8B-1%EF%BC%9AWKT-%E2%86%92-GeoJSON"><span class="toc-number">1.1.3.4.1.</span> <span class="toc-text">1. 示例 1：WKT → GeoJSON</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%A4%BA%E4%BE%8B-2%EF%BC%9AKML-%E2%86%92-EWKT"><span class="toc-number">1.1.3.4.2.</span> <span class="toc-text">2. 示例 2：KML → EWKT</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%9D%90%E6%A0%87%E7%B3%BB%E8%BD%AC%E6%8D%A2%EF%BC%88SRID-%E5%8F%98%E6%9B%B4%EF%BC%89"><span class="toc-number">1.1.3.5.</span> <span class="toc-text">5. 坐标系转换（SRID 变更）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%80%BB%E7%BB%93"><span class="toc-number">1.1.3.6.</span> <span class="toc-text">6. 总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A2%9E%E5%88%A0%E6%9F%A5%E6%94%B9"><span class="toc-number">1.1.4.</span> <span class="toc-text">空间数据的增删查改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%B8%A6%E7%A9%BA%E9%97%B4%E5%AD%97%E6%AE%B5%E7%9A%84%E8%A1%A8"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">1. 准备工作：创建带空间字段的表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%A2%9E%E5%8A%A0%EF%BC%88Create%EF%BC%89%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">2. 增加（Create）空间数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%A4%BA%E4%BE%8B%EF%BC%9A%E6%8F%92%E5%85%A5%E5%9F%8E%E5%B8%82%E7%82%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.4.2.1.</span> <span class="toc-text">1. 示例：插入城市点数据</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%9F%A5%E8%AF%A2%EF%BC%88Read%EF%BC%89%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">3. 查询（Read）空间数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%A4%BA%E4%BE%8B-1%EF%BC%9A%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%9F%8E%E5%B8%82%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E5%92%8C%E7%A9%BA%E9%97%B4%E5%9D%90%E6%A0%87%EF%BC%88WKT-%E6%A0%BC%E5%BC%8F%EF%BC%89"><span class="toc-number">1.1.4.3.1.</span> <span class="toc-text">1. 示例 1：查询所有城市的基本信息和空间坐标（WKT 格式）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%A4%BA%E4%BE%8B-2%EF%BC%9A%E6%9F%A5%E8%AF%A2%E8%B7%9D%E7%A6%BB%E5%8C%97%E4%BA%AC-1000-%E5%85%AC%E9%87%8C%E4%BB%A5%E5%86%85%E7%9A%84%E5%9F%8E%E5%B8%82%EF%BC%88%E7%94%A8-geography-%E7%B1%BB%E5%9E%8B%E8%AE%A1%E7%AE%97%E7%90%83%E9%9D%A2%E8%B7%9D%E7%A6%BB%EF%BC%89"><span class="toc-number">1.1.4.3.2.</span> <span class="toc-text">2. 示例 2：查询距离北京 1000 公里以内的城市（用 geography 类型计算球面距离）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E7%A4%BA%E4%BE%8B-3%EF%BC%9A%E6%9F%A5%E8%AF%A2%E6%9F%90%E7%9F%A9%E5%BD%A2%E8%8C%83%E5%9B%B4%E5%86%85%E7%9A%84%E5%9F%8E%E5%B8%82%EF%BC%88%E5%A6%82%E7%BB%8F%E5%BA%A6-110%C2%B0-120%C2%B0%EF%BC%8C%E7%BA%AC%E5%BA%A6-20%C2%B0-35%C2%B0%EF%BC%89"><span class="toc-number">1.1.4.3.3.</span> <span class="toc-text">3. 示例 3：查询某矩形范围内的城市（如经度 110°~120°，纬度 20°~35°）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%9B%B4%E6%96%B0%EF%BC%88Update%EF%BC%89%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.4.4.</span> <span class="toc-text">4. 更新（Update）空间数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%A4%BA%E4%BE%8B-1%EF%BC%9A%E4%BF%AE%E6%94%B9%E5%9F%8E%E5%B8%82%E7%9A%84%E5%9D%90%E6%A0%87%EF%BC%88%E5%A6%82%E8%B0%83%E6%95%B4%E6%B7%B1%E5%9C%B3%E7%9A%84%E7%BB%8F%E7%BA%AC%E5%BA%A6%EF%BC%89"><span class="toc-number">1.1.4.4.1.</span> <span class="toc-text">1. 示例 1：修改城市的坐标（如调整深圳的经纬度）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%A4%BA%E4%BE%8B-2%EF%BC%9A%E6%89%B9%E9%87%8F%E6%9B%B4%E6%96%B0%E5%9D%90%E6%A0%87%E7%B3%BB%EF%BC%88%E5%A6%82%E4%BB%8E-SRID-4326-%E8%BD%AC%E4%B8%BA-UTM-50N-%E7%9A%84-SRID-32650%EF%BC%89"><span class="toc-number">1.1.4.4.2.</span> <span class="toc-text">2. 示例 2：批量更新坐标系（如从 SRID&#x3D;4326 转为 UTM 50N 的 SRID&#x3D;32650）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%88%A0%E9%99%A4%EF%BC%88Delete%EF%BC%89%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.4.5.</span> <span class="toc-text">5. 删除（Delete）空间数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%A4%BA%E4%BE%8B-1%EF%BC%9A%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A%E5%9F%8E%E5%B8%82"><span class="toc-number">1.1.4.5.1.</span> <span class="toc-text">1. 示例 1：删除指定城市</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%A4%BA%E4%BE%8B-2%EF%BC%9A%E5%88%A0%E9%99%A4%E4%BA%BA%E5%8F%A3%E5%B0%91%E4%BA%8E-1000-%E4%B8%87%E7%9A%84%E5%9F%8E%E5%B8%82"><span class="toc-number">1.1.4.5.2.</span> <span class="toc-text">2. 示例 2：删除人口少于 1000 万的城市</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%80%BB%E7%BB%93-2"><span class="toc-number">1.1.4.6.</span> <span class="toc-text">6. 总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%9F%BA%E7%A1%80%E7%A9%BA%E9%97%B4%E6%9F%A5%E8%AF%A2%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.5.</span> <span class="toc-text">常用基础空间查询函数的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80-%E5%87%A0%E4%BD%95%E5%85%B3%E7%B3%BB%E6%9F%A5%E8%AF%A2%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">一. 几何关系查询函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-ST-Contains-geomA-geomB"><span class="toc-number">1.1.5.1.1.</span> <span class="toc-text">1. ST_Contains(geomA, geomB)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-ST-Intersects-geomA-geomB"><span class="toc-number">1.1.5.1.2.</span> <span class="toc-text">2. ST_Intersects(geomA, geomB)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-ST-DWithin-geomA-geomB-distance"><span class="toc-number">1.1.5.1.3.</span> <span class="toc-text">3. ST_DWithin(geomA, geomB, distance)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-ST-Touches-geomA-geomB"><span class="toc-number">1.1.5.1.4.</span> <span class="toc-text">4. ST_Touches(geomA, geomB)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-%E6%B5%8B%E9%87%8F%E8%AE%A1%E7%AE%97%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">二、 测量计算函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-ST-Distance-geomA-geomB"><span class="toc-number">1.1.5.2.1.</span> <span class="toc-text">1. ST_Distance(geomA, geomB)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-ST-Length-geom"><span class="toc-number">1.1.5.2.2.</span> <span class="toc-text">2. ST_Length(geom)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-ST-Area-geom"><span class="toc-number">1.1.5.2.3.</span> <span class="toc-text">3. ST_Area(geom)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-ST-Perimeter-geom"><span class="toc-number">1.1.5.2.4.</span> <span class="toc-text">4. ST_Perimeter(geom)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%87%A0%E4%BD%95%E8%BD%AC%E6%8D%A2%E4%B8%8E%E6%8F%90%E5%8F%96%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.5.3.</span> <span class="toc-text">三、几何转换与提取函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-ST-AsText-geom-ST-AsGeoJSON-geom"><span class="toc-number">1.1.5.3.1.</span> <span class="toc-text">1. ST_AsText(geom)&#x2F;ST_AsGeoJSON(geom)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-ST-Centroid-geom"><span class="toc-number">1.1.5.3.2.</span> <span class="toc-text">2. ST_Centroid(geom)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-ST-Transform-geom-target-srid"><span class="toc-number">1.1.5.3.3.</span> <span class="toc-text">3. ST_Transform(geom, target_srid)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-ST-Buffer-geom-distance"><span class="toc-number">1.1.5.3.4.</span> <span class="toc-text">4. ST_Buffer(geom, distance)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%87%A0%E4%BD%95%E5%B1%9E%E6%80%A7%E6%9F%A5%E8%AF%A2%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.5.4.</span> <span class="toc-text">四、几何属性查询函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-ST-GeometryType-geom"><span class="toc-number">1.1.5.4.1.</span> <span class="toc-text">1. ST_GeometryType(geom)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-ST-SRID-geom"><span class="toc-number">1.1.5.4.2.</span> <span class="toc-text">2. ST_SRID(geom)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-ST-NPoints-geom"><span class="toc-number">1.1.5.4.3.</span> <span class="toc-text">3. ST_NPoints(geom)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">1.1.5.5.</span> <span class="toc-text">五、总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%88%86%E6%9E%90%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.6.</span> <span class="toc-text">常用分析函数的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%BC%93%E5%86%B2%E5%8C%BA%E5%88%86%E6%9E%90%EF%BC%88Buffer-Analysis%EF%BC%89"><span class="toc-number">1.1.6.1.</span> <span class="toc-text">一、缓冲区分析（Buffer Analysis）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%87%BD%E6%95%B0%EF%BC%9AST-Buffer-geom-distance"><span class="toc-number">1.1.6.1.1.</span> <span class="toc-text">1. 函数：ST_Buffer(geom, distance)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%8F%A0%E5%8A%A0%E5%88%86%E6%9E%90"><span class="toc-number">1.1.6.2.</span> <span class="toc-text">二、叠加分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-ST-Intersection-geomA-geomB"><span class="toc-number">1.1.6.2.1.</span> <span class="toc-text">1. ST_Intersection(geomA, geomB)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-ST-Union-geomA-geomB"><span class="toc-number">1.1.6.2.2.</span> <span class="toc-text">2. ST_Union(geomA, geomB)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-ST-Difference-geomA-geomB"><span class="toc-number">1.1.6.2.3.</span> <span class="toc-text">3. ST_Difference(geomA, geomB)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%9C%80%E8%BF%91%E9%82%BB%E5%88%86%E6%9E%90%EF%BC%88Nearest-Neighbor%EF%BC%89"><span class="toc-number">1.1.6.3.</span> <span class="toc-text">三、最近邻分析（Nearest Neighbor）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%87%BD%E6%95%B0%E7%BB%84%E5%90%88%EF%BC%9AST-Distance-%E6%8E%92%E5%BA%8F"><span class="toc-number">1.1.6.3.1.</span> <span class="toc-text">1. 函数组合：ST_Distance + 排序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%AF%86%E5%BA%A6%E5%88%86%E6%9E%90%EF%BC%88Density-Analysis%EF%BC%89"><span class="toc-number">1.1.6.4.</span> <span class="toc-text">四、密度分析（Density Analysis）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%94%9F%E6%88%90%E7%BD%91%E6%A0%BC%E5%B9%B6%E7%BB%9F%E8%AE%A1%E5%AF%86%E5%BA%A6"><span class="toc-number">1.1.6.4.1.</span> <span class="toc-text">1. 生成网格并统计密度</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%A0%B8%E5%AF%86%E5%BA%A6%E4%BC%B0%E8%AE%A1%EF%BC%88%E9%9C%80-PostGIS-3-0-%EF%BC%89"><span class="toc-number">1.1.6.4.2.</span> <span class="toc-text">2. 核密度估计（需 PostGIS 3.0+）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%EF%BC%88Network-Analysis%EF%BC%89"><span class="toc-number">1.1.6.5.</span> <span class="toc-text">五、网络分析（Network Analysis）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%BA%BF%E4%B8%B2%E6%8B%86%E5%88%86%E4%B8%8E%E8%8A%82%E7%82%B9%E6%8F%90%E5%8F%96"><span class="toc-number">1.1.6.5.1.</span> <span class="toc-text">1. 线串拆分与节点提取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84"><span class="toc-number">1.1.6.5.2.</span> <span class="toc-text">2. 最短路径</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E7%A9%BA%E9%97%B4%E8%81%9A%E5%90%88%E5%88%86%E6%9E%90"><span class="toc-number">1.1.6.6.</span> <span class="toc-text">六、空间聚合分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">1.1.6.7.</span> <span class="toc-text">七、总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E6%9C%8810%E6%97%A5-%E7%AC%AC%E4%BA%8C%E5%A4%A9"><span class="toc-number">1.2.</span> <span class="toc-text">10月10日 第二天</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/12184/" title="实习学习笔记"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://bu.dusays.com/2024/11/24/674340e56737a.png?_r_=ed1770ed-590c-2382-be9f-039dfc8226f1" onerror='this.onerror=null,this.src="https://bu.dusays.com/2025/05/30/68398ca86a127.gif"' alt="实习学习笔记"></a><div class="content"><a class="title" href="/posts/12184/" title="实习学习笔记">实习学习笔记</a><time datetime="2025-10-09T01:34:21.000Z" title="发表于 2025-10-09 09:34:21">2025-10-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/65070/" title="实习日志"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://bu.dusays.com/2024/11/24/674340e1191e4.png?_r_=4df18ead-b896-9763-5b8b-8b2b8754a0cf" onerror='this.onerror=null,this.src="https://bu.dusays.com/2025/05/30/68398ca86a127.gif"' alt="实习日志"></a><div class="content"><a class="title" href="/posts/65070/" title="实习日志">实习日志</a><time datetime="2025-10-09T01:34:21.000Z" title="发表于 2025-10-09 09:34:21">2025-10-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/23309/" title="PostgreSQL教程"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://bu.dusays.com/2024/11/24/674340e362114.png?_r_=6156a4bd-adf2-b3aa-924b-973468f85222" onerror='this.onerror=null,this.src="https://bu.dusays.com/2025/05/30/68398ca86a127.gif"' alt="PostgreSQL教程"></a><div class="content"><a class="title" href="/posts/23309/" title="PostgreSQL教程">PostgreSQL教程</a><time datetime="2025-10-02T02:34:21.000Z" title="发表于 2025-10-02 10:34:21">2025-10-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/28220/" title="MySQL+MyBatis+MyBatisPlus"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://bu.dusays.com/2024/11/24/674340e0cd15e.png?_r_=c6b3fbe1-2237-4914-1dc7-18a0db885ecc" onerror='this.onerror=null,this.src="https://bu.dusays.com/2025/05/30/68398ca86a127.gif"' alt="MySQL+MyBatis+MyBatisPlus"></a><div class="content"><a class="title" href="/posts/28220/" title="MySQL+MyBatis+MyBatisPlus">MySQL+MyBatis+MyBatisPlus</a><time datetime="2025-09-30T02:34:21.000Z" title="发表于 2025-09-30 10:34:21">2025-09-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/21192/" title="面经"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://bu.dusays.com/2025/05/30/68398ca86a127.gif&quot;" data-lazy-src="https://bu.dusays.com/2024/11/24/674340e151d6a.png?_r_=f96b4b60-e054-e337-0c45-a45159026be7" onerror='this.onerror=null,this.src="https://bu.dusays.com/2025/05/30/68398ca86a127.gif"' alt="面经"></a><div class="content"><a class="title" href="/posts/21192/" title="面经">面经</a><time datetime="2025-09-27T11:34:21.000Z" title="发表于 2025-09-27 19:34:21">2025-09-27</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By 李阳</div><div class="footer_custom_text">下次再见！</div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i> <span>隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i> <span>分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i> <span>标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tongji1"></use></svg> <span>统计</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=12781955100&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i> <span>耳机分你一半</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i> <span>留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-zuji"></use></svg> <span>脚步</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/essay/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-taiyang"></use></svg> <span>小太阳</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-a-xiaoyangyang_huaban1"></use></svg> <span>了解我</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/408/" style="font-size:.88rem">408<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size:.88rem">C语言<sup>1</sup></a><a href="/tags/java/" style="font-size:.88rem;font-weight:500;color:var(--anzhiyu-lighttext)">java<sup>1</sup></a><a href="/tags/javaweb/" style="font-size:.88rem">javaweb<sup>8</sup></a><a href="/tags/%E5%8A%9B%E6%89%A3%E5%88%B7%E9%A2%98/" style="font-size:.88rem">力扣刷题<sup>1</sup></a><a href="/tags/%E5%AE%9E%E4%B9%A0/" style="font-size:.88rem">实习<sup>3</sup></a><a href="/tags/%E5%AE%9E%E4%B9%A0%E7%AF%87/" style="font-size:.88rem">实习篇<sup>1</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size:.88rem">操作系统<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size:.88rem">数据结构<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" style="font-size:.88rem">计算机组成原理<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size:.88rem">计算机网络<sup>2</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/" style="font-size:.88rem">软件工程<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size:.88rem">面试<sup>4</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight,500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="12781955100" server="netease" type="playlist" mutex="true" preload="none" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=12781955100&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js").then((()=>{pangu.autoSpacingPage()}))}function panguInit(){GLOBAL_CONFIG_SITE.isPost&&panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>var HoldLog=console.log;console.log=function(){};let now1=new Date;queueMicrotask((()=>{const o=function(){HoldLog.apply(console,arguments)},n=new Date("04/01/2021 00:00:00");now1.setTime(now1.getTime()+250);const c=(now1-n)/1e3/60/60/24,e=["欢迎使用安知鱼!","生活明朗, 万物可爱","\n        \n       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗\n      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║\n      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║\n      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║\n      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝\n      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝\n        \n        ","已上线",Math.floor(c),"天","©2024 By 安知鱼 V1.6.14"],t=["NCC2-036","调用前置摄像头拍照成功，识别为【小笨蛋】.","Photo captured: ","🤪"];setTimeout(o.bind(console,`\n%c${e[0]} %c ${e[1]} %c ${e[2]} %c${e[3]}%c ${e[4]}%c ${e[5]}\n\n%c ${e[6]}\n`,"color:#425AEF","","color:#425AEF","color:#425AEF","","color:#425AEF","")),setTimeout(o.bind(console,`%c ${t[0]} %c ${t[1]} %c \n${t[2]} %c\n${t[3]}\n`,"color:white; background-color:#4fd953","","",'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%')),setTimeout(o.bind(console,"%c WELCOME %c 你好，小笨蛋.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c ⚡ Powered by 安知鱼 %c 你正在访问 李阳 的博客.","color:white; background-color:#f0ad4e","")),setTimeout(o.bind(console,"%c W23-12 %c 你已打开控制台.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c S013-782 %c 你现在正处于监控中.","color:white; background-color:#d9534f",""))}))</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><link rel="stylesheet" href="https://cdn.cbd.int/katex@0.16.0/dist/katex.min.css"><script src="https://cdn.cbd.int/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script>document.querySelectorAll("#article-container span.katex-display").forEach((a=>{anzhiyu.wrap(a,"div",{class:"katex-wrap"})}))</script><script>(()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";Array.from(e).forEach(((e,n)=>{const d=e.firstElementChild,r="mermaid-"+n,a="%%{init:{ 'theme':'"+t+"'}}%%\n"+d.textContent,i=mermaid.render(r,a);var m;"string"==typeof i?(m=i,d.insertAdjacentHTML("afterend",m)):i.then((({svg:e})=>{d.insertAdjacentHTML("afterend",e)}))}))},n=()=>{window.loadMermaid?t():getScript("https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js").then(t)};anzhiyu.addGlobalFn("themeChange",t,"mermaid"),window.pjax?n():document.addEventListener("DOMContentLoaded",n)})()</script><script>(()=>{const t=()=>{"object"==typeof twikoo?setTimeout(o,0):getScript("https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js").then(o)},o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo.baskly.fun",region:"",onCommentLoaded:()=>{anzhiyu.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null)),GLOBAL_CONFIG_SITE.isPost&&(()=>{const t=document.getElementById("twikoo-count");t&&twikoo.getCommentsCount({envId:"https://twikoo.baskly.fun",region:"",urls:[window.location.pathname],includeReply:!1}).then((o=>{t.textContent=o[0].count})).catch((t=>{console.error(t)}))})()};t()})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener("load",(()=>{const e=e=>{let t="";if(e.length)for(let n=0;n<e.length;n++){t+="<div class='aside-list-item'>";{const a="data-lazy-src";t+=`<a href='${e[n].url}' class='thumbnail'><img ${a}='${e[n].avatar}' alt='${e[n].nick}'><div class='name'><span>${e[n].nick} </span></div></a>`}t+=`<div class='content'>\n        <a class='comment' href='${e[n].url}' title='${e[n].content}'>${e[n].content}</a>\n        <time datetime="${e[n].date}">${anzhiyu.diffDate(e[n].date,!0)}</time></div>\n        </div>`}else t+="没有评论";let n=document.querySelector("#card-newest-comments .aside-list");n&&(n.innerHTML=t),window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(n)},t=()=>{if(document.querySelector("#card-newest-comments .aside-list")){const t=saveToLocal.get("twikoo-newest-comments");t?e(JSON.parse(t)):(()=>{const t=()=>{twikoo.getRecentComments({envId:"https://twikoo.baskly.fun",region:"",pageSize:6,includeReply:!0}).then((function(t){const n=t.map((e=>{return{content:(t=e.comment,""===t||(t=(t=(t=(t=t.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length>150&&(t=t.substring(0,150)+"..."),t),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.id,date:new Date(e.created).toISOString()};var t}));saveToLocal.set("twikoo-newest-comments",JSON.stringify(n),10/1440),e(n)})).catch((function(e){document.querySelector("#card-newest-comments .aside-list").textContent="无法获取评论，请确认相关配置是否正确"}))};"object"==typeof twikoo?t():getScript("https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js").then(t)})()}};t(),document.addEventListener("pjax:complete",t)}))</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail="yang@li.com"</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script async src="//at.alicdn.com/t/c/font_4782341_g014uvnbwk6.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/echarts/4.9.0-rc.1/echarts.min.js"></script><script src="https://lib.baomitu.com/echarts/4.9.0-rc.1/echarts.min.js"></script><script src="https://jsd-proxy.ygxz.in/gh/lyay23/blogstatic@v1.0.0/static/imgloaded.min.js"></script><script src="https://jsd-proxy.ygxz.in/gh/lyay23/blogstatic@v1.0.0/static/countdown.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors=['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:type"]','meta[property="og:site_name"]','meta[property="og:description"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/music/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(anzhiyu.removeGlobalFnEvent("pjax"),anzhiyu.removeGlobalFnEvent("themeChange"),document.getElementById("rightside").classList.remove("rightside-show"),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)})),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404.html")}))</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>